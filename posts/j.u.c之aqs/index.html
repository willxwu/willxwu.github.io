<!doctype html><html lang=en><head><title>// willxwu</title><link rel="shortcut icon" href=/favicon.ico><meta charset=utf-8><meta name=generator content="Hugo 0.114.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="willxwu"><meta name=description content><link rel=stylesheet href=https://willxwu.github.io/css/main.min.68e582a4d4ed824d6b7e3b5b37cae47eb3779bd631046379d0e68b38230cc3e2.css><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="AQS J.U.C之AQS，底层由线程队列实现。AbstractQueuedSynchronizer简称AQS，JUC的核心。
使用Node实现FIFO队列，可以用于构建锁或者其他同步装置的基础框架。 利用了一个int类型表示状态。 使用方法是继承。 子类通过继承并通过实现它的方法管理其状态{acquire和release}的方法操纵状态。 可以同时实现排它锁和共享锁模式（独占、共享）。
AQS主要同步组件 CountDownLatch
Semaphore
CyclicBarrier
ReentrantLock
Condition
FutureTask
依次介绍 1、CountDownLatch-闭锁 可以完成类似阻塞的功能。一个线程或多个线程等待，直到其它线程完成。使用场景，程序执行需要某个条件执行完后，才执行。
示例一 package com.yanxizhu.demo.concurrency.aqs; import com.yanxizhu.demo.concurrency.annotation.ThreadSafety; import lombok.extern.slf4j.Slf4j; import java.util.concurrent.CountDownLatch; import java.util.concurrent.ExecutorService; import java.util.concurrent.Executors; /** * @description: CountDownLatch,实现线程阻塞，等待执行完再执行程序打印 * @author: <a href=&#34;mailto:batis@foxmail.com&#34;>清风</a> * @date: 2022/4/25 20:24 * @version: 1.0 */ @Slf4j @ThreadSafety public class CountDownLatchDemo { private static final int threadNum = 500; public static void main(String[] args) throws InterruptedException { ExecutorService executorService = Executors."><meta property="og:title" content><meta property="og:description" content="AQS J.U.C之AQS，底层由线程队列实现。AbstractQueuedSynchronizer简称AQS，JUC的核心。
使用Node实现FIFO队列，可以用于构建锁或者其他同步装置的基础框架。 利用了一个int类型表示状态。 使用方法是继承。 子类通过继承并通过实现它的方法管理其状态{acquire和release}的方法操纵状态。 可以同时实现排它锁和共享锁模式（独占、共享）。
AQS主要同步组件 CountDownLatch
Semaphore
CyclicBarrier
ReentrantLock
Condition
FutureTask
依次介绍 1、CountDownLatch-闭锁 可以完成类似阻塞的功能。一个线程或多个线程等待，直到其它线程完成。使用场景，程序执行需要某个条件执行完后，才执行。
示例一 package com.yanxizhu.demo.concurrency.aqs; import com.yanxizhu.demo.concurrency.annotation.ThreadSafety; import lombok.extern.slf4j.Slf4j; import java.util.concurrent.CountDownLatch; import java.util.concurrent.ExecutorService; import java.util.concurrent.Executors; /** * @description: CountDownLatch,实现线程阻塞，等待执行完再执行程序打印 * @author: <a href=&#34;mailto:batis@foxmail.com&#34;>清风</a> * @date: 2022/4/25 20:24 * @version: 1.0 */ @Slf4j @ThreadSafety public class CountDownLatchDemo { private static final int threadNum = 500; public static void main(String[] args) throws InterruptedException { ExecutorService executorService = Executors."><meta property="og:type" content="article"><meta property="og:url" content="https://willxwu.github.io/posts/j.u.c%E4%B9%8Baqs/"><meta property="article:section" content="posts"></head><body><header class=app-header><a href=https://willxwu.github.io/><img class=app-header-avatar src=/avatar.jpg alt=willxwu></a><h1>willxwu</h1><p>生活哪有那么复杂，简单甚好。@万般滋味，皆是生活。</p><div class=app-header-social><a target=_blank href=https://github.com/willxwu rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a target=_blank href=https://twitter.com/i2school rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><title>twitter</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a target=_blank href=https://twitter.com/willxwu rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-umbrella"><title>umbrella</title><path d="M23 12A11.05 11.05.0 001 12zm-5 7a3 3 0 01-6 0v-7"/></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title></h1><div class=post-meta><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Jan 1, 0001</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>11 min read</div></div></header><div class=post-content><h1 id=aqs>AQS</h1><p>J.U.C之AQS，底层由线程队列实现。AbstractQueuedSynchronizer简称AQS，JUC的核心。</p><p><img src=https://cdn.jsdelivr.net/gh/willxwu/CDN@main/images/202204252000380.png alt></p><p>使用Node实现FIFO队列，可以用于构建锁或者其他同步装置的基础框架。
利用了一个int类型表示状态。
使用方法是继承。
子类通过继承并通过实现它的方法管理其状态{acquire和release}的方法操纵状态。
可以同时实现排它锁和共享锁模式（独占、共享）。</p><h1 id=aqs主要同步组件>AQS主要同步组件</h1><ol><li><p>CountDownLatch</p></li><li><p>Semaphore</p></li><li><p>CyclicBarrier</p></li><li><p>ReentrantLock</p></li><li><p>Condition</p></li><li><p>FutureTask</p></li></ol><h1 id=依次介绍>依次介绍</h1><h1 id=1countdownlatch-闭锁>1、CountDownLatch-闭锁</h1><p><img src=https://cdn.jsdelivr.net/gh/willxwu/CDN@main/images/202204252013410.png alt></p><p>可以完成类似阻塞的功能。一个线程或多个线程等待，直到其它线程完成。使用场景，程序执行需要某个条件执行完后，才执行。</p><h2 id=示例一>示例一</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.yanxizhu.demo.concurrency.aqs<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.yanxizhu.demo.concurrency.annotation.ThreadSafety<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> lombok.extern.slf4j.Slf4j<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.CountDownLatch<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.ExecutorService<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.Executors<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @description: CountDownLatch,实现线程阻塞，等待执行完再执行程序打印
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author: &lt;a href=&#34;mailto:batis@foxmail.com&#34;&gt;清风&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @date: 2022/4/25 20:24
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @version: 1.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@ThreadSafety</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> threadNum <span style=color:#f92672>=</span> <span style=color:#ae81ff>500</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        ExecutorService executorService <span style=color:#f92672>=</span> Executors<span style=color:#f92672>.</span><span style=color:#a6e22e>newCachedThreadPool</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        CountDownLatch countDownLatch <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CountDownLatch<span style=color:#f92672>(</span>threadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span>threadNum<span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> num <span style=color:#f92672>=</span> i<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    pringNum<span style=color:#f92672>(</span>num<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span><span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                    log<span style=color:#f92672>.</span><span style=color:#a6e22e>error</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;执行错误【{}】&#34;</span><span style=color:#f92672>,</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span><span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    countDownLatch<span style=color:#f92672>.</span><span style=color:#a6e22e>countDown</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        countDownLatch<span style=color:#f92672>.</span><span style=color:#a6e22e>await</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>shutdown</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;finash ..&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>pringNum</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> num<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span><span style=color:#ae81ff>100</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;num=【{}】&#34;</span><span style=color:#f92672>,</span> num<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span><span style=color:#ae81ff>100</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>输出结果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>。。。。。</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.598</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>249</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>248</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.608</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>259</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>258</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.597</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>237</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>236</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.597</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>206</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>205</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.608</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>256</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>255</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.608</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>258</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>257</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.597</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>240</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>239</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.597</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>67</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>66</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.608</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>251</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>250</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.608</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>257</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>256</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.608</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>44</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>43</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.598</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>61</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>60</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.598</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>33</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>32</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.597</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>172</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>171</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.608</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>230</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>229</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.608</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>253</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>252</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.598</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>59</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>58</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.598</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>39</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>38</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.608</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>298</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>297</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.596</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>192</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>191</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.597</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>75</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>74</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.608</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>299</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>298</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.597</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>146</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>145</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.608</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>304</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>303</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.598</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>229</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>228</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.597</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>87</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>86</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.597</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>46</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>45</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.764</span> <span style=color:#f92672>[</span>main<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> finash <span style=color:#f92672>..</span>
</span></span></code></pre></div><p>另一种用法，给定时间内未执行执行await方法。到时间等当前线程执行完成后就不执行了。</p><h2 id=示例一-1>示例一</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.yanxizhu.demo.concurrency.aqs<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.yanxizhu.demo.concurrency.annotation.ThreadSafety<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> lombok.extern.slf4j.Slf4j<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.CountDownLatch<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.ExecutorService<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.Executors<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.TimeUnit<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @description: CountDownLatch,设置等待时间
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author: &lt;a href=&#34;mailto:batis@foxmail.com&#34;&gt;清风&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @date: 2022/4/25 20:24
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @version: 1.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@ThreadSafety</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CountDownLatchDemo2</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> threadNum <span style=color:#f92672>=</span> <span style=color:#ae81ff>500</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        ExecutorService executorService <span style=color:#f92672>=</span> Executors<span style=color:#f92672>.</span><span style=color:#a6e22e>newCachedThreadPool</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        CountDownLatch countDownLatch <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CountDownLatch<span style=color:#f92672>(</span>threadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span>threadNum<span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> num <span style=color:#f92672>=</span> i<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    pringNum<span style=color:#f92672>(</span>num<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span><span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                    log<span style=color:#f92672>.</span><span style=color:#a6e22e>error</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;执行错误【{}】&#34;</span><span style=color:#f92672>,</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span><span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    countDownLatch<span style=color:#f92672>.</span><span style=color:#a6e22e>countDown</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>//设置了等待时间
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        countDownLatch<span style=color:#f92672>.</span><span style=color:#a6e22e>await</span><span style=color:#f92672>(</span><span style=color:#ae81ff>100</span><span style=color:#f92672>,</span> TimeUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>MILLISECONDS</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>shutdown</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;finash ..&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>pringNum</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> num<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span><span style=color:#ae81ff>100</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;num=【{}】&#34;</span><span style=color:#f92672>,</span> num<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>输出结果</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>39</span><span style=color:#f92672>:</span><span style=color:#ae81ff>27.285</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>258</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>257</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>39</span><span style=color:#f92672>:</span><span style=color:#ae81ff>27.284</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>180</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>179</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>39</span><span style=color:#f92672>:</span><span style=color:#ae81ff>27.287</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>54</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>53</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>39</span><span style=color:#f92672>:</span><span style=color:#ae81ff>27.283</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>368</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>367</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>39</span><span style=color:#f92672>:</span><span style=color:#ae81ff>27.285</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>8</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>7</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>39</span><span style=color:#f92672>:</span><span style=color:#ae81ff>27.301</span> <span style=color:#f92672>[</span>main<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo2</span> <span style=color:#f92672>-</span> finash <span style=color:#f92672>..</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>39</span><span style=color:#f92672>:</span><span style=color:#ae81ff>27.286</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>204</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>203</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>39</span><span style=color:#f92672>:</span><span style=color:#ae81ff>27.301</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>42</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>41</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>39</span><span style=color:#f92672>:</span><span style=color:#ae81ff>27.305</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>432</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>431</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>39</span><span style=color:#f92672>:</span><span style=color:#ae81ff>27.285</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>270</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>269</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span></code></pre></div><p>100毫秒后执行打印finash，之后的线程执行完后不再执行。</p><h1 id=2semaphore-信号量>2、Semaphore-信号量</h1><p>用于控制线程并发的个数。使用场景，提供仅限使用的资源。比如：有大量请求时，可用信号量控制数据库连接数，防止大量请求。</p><p><img src=https://cdn.jsdelivr.net/gh/willxwu/CDN@main/images/202204252042691.png alt></p><h2 id=示例一-2>示例一</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.yanxizhu.demo.concurrency.aqs<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.yanxizhu.demo.concurrency.annotation.ThreadSafety<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> lombok.extern.slf4j.Slf4j<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.*<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @description: Semaphore-信号量，控制线程并发数
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author: &lt;a href=&#34;mailto:batis@foxmail.com&#34;&gt;清风&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @date: 2022/4/25 20:41
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @version: 1.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@ThreadSafety</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> threadNum <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> currentThreadNum <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//线程池
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        ExecutorService executorService <span style=color:#f92672>=</span> Executors<span style=color:#f92672>.</span><span style=color:#a6e22e>newCachedThreadPool</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//信号量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        Semaphore semaphore <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Semaphore<span style=color:#f92672>(</span>currentThreadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span>threadNum<span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> num <span style=color:#f92672>=</span> i<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>//获取一个许可
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    semaphore<span style=color:#f92672>.</span><span style=color:#a6e22e>acquire</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                    pringNum<span style=color:#f92672>(</span>num<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>//释放一个许可
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    semaphore<span style=color:#f92672>.</span><span style=color:#a6e22e>release</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span><span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                    log<span style=color:#f92672>.</span><span style=color:#a6e22e>error</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;执行错误【{}】&#34;</span><span style=color:#f92672>,</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>shutdown</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>pringNum</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> num<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;num=【{}】&#34;</span><span style=color:#f92672>,</span> num<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1000</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>输出结果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#e6db74>&#34;C:\Program Files\jdk-11.0.10_windows-x64_bin\jdk-11.0.10\bin\java.exe&#34;</span> <span style=color:#f92672>-</span>Dvisualvm<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#ae81ff>83604261825100</span> <span style=color:#e6db74>&#34;-javaagent:C:\Program Files\JetBrains\IntelliJ IDEA 2020.3.2\lib\idea_rt.jar=11416:C:\Program Files\JetBrains\IntelliJ IDEA 2020.3.2\bin&#34;</span> <span style=color:#f92672>-</span>Dfile<span style=color:#f92672>.</span><span style=color:#a6e22e>encoding</span><span style=color:#f92672>=</span>UTF<span style=color:#f92672>-</span><span style=color:#ae81ff>8</span> <span style=color:#f92672>-</span>classpath D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Workspaces<span style=color:#960050;background-color:#1e0010>\</span>ThreadConcurrency<span style=color:#960050;background-color:#1e0010>\</span>demo<span style=color:#f92672>-</span>concurrency<span style=color:#960050;background-color:#1e0010>\</span>target<span style=color:#960050;background-color:#1e0010>\</span>classes<span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>boot<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>starter<span style=color:#f92672>-</span>web<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>2.6.6</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>starter<span style=color:#f92672>-</span>web<span style=color:#f92672>-</span><span style=color:#ae81ff>2.6.6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>boot<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>starter<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>2.6.6</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>starter<span style=color:#f92672>-</span><span style=color:#ae81ff>2.6.6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>boot<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>starter<span style=color:#f92672>-</span>logging<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>2.6.6</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>starter<span style=color:#f92672>-</span>logging<span style=color:#f92672>-</span><span style=color:#ae81ff>2.6.6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>ch<span style=color:#960050;background-color:#1e0010>\</span>qos<span style=color:#960050;background-color:#1e0010>\</span>logback<span style=color:#960050;background-color:#1e0010>\</span>logback<span style=color:#f92672>-</span>classic<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>1.2.11</span><span style=color:#960050;background-color:#1e0010>\</span>logback<span style=color:#f92672>-</span>classic<span style=color:#f92672>-</span><span style=color:#ae81ff>1.2.11</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>ch<span style=color:#960050;background-color:#1e0010>\</span>qos<span style=color:#960050;background-color:#1e0010>\</span>logback<span style=color:#960050;background-color:#1e0010>\</span>logback<span style=color:#f92672>-</span>core<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>1.2.11</span><span style=color:#960050;background-color:#1e0010>\</span>logback<span style=color:#f92672>-</span>core<span style=color:#f92672>-</span><span style=color:#ae81ff>1.2.11</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>apache<span style=color:#960050;background-color:#1e0010>\</span>logging<span style=color:#960050;background-color:#1e0010>\</span>log4j<span style=color:#960050;background-color:#1e0010>\</span>log4j<span style=color:#f92672>-</span>to<span style=color:#f92672>-</span>slf4j<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>2.17.2</span><span style=color:#960050;background-color:#1e0010>\</span>log4j<span style=color:#f92672>-</span>to<span style=color:#f92672>-</span>slf4j<span style=color:#f92672>-</span><span style=color:#ae81ff>2.17.2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>apache<span style=color:#960050;background-color:#1e0010>\</span>logging<span style=color:#960050;background-color:#1e0010>\</span>log4j<span style=color:#960050;background-color:#1e0010>\</span>log4j<span style=color:#f92672>-</span>api<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>2.17.2</span><span style=color:#960050;background-color:#1e0010>\</span>log4j<span style=color:#f92672>-</span>api<span style=color:#f92672>-</span><span style=color:#ae81ff>2.17.2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>slf4j<span style=color:#960050;background-color:#1e0010>\</span>jul<span style=color:#f92672>-</span>to<span style=color:#f92672>-</span>slf4j<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>1.7.36</span><span style=color:#960050;background-color:#1e0010>\</span>jul<span style=color:#f92672>-</span>to<span style=color:#f92672>-</span>slf4j<span style=color:#f92672>-</span><span style=color:#ae81ff>1.7.36</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>jakarta<span style=color:#960050;background-color:#1e0010>\</span>annotation<span style=color:#960050;background-color:#1e0010>\</span>jakarta<span style=color:#f92672>.</span><span style=color:#a6e22e>annotation</span><span style=color:#f92672>-</span>api<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>1.3.5</span><span style=color:#960050;background-color:#1e0010>\</span>jakarta<span style=color:#f92672>.</span><span style=color:#a6e22e>annotation</span><span style=color:#f92672>-</span>api<span style=color:#f92672>-</span><span style=color:#ae81ff>1.3.5</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>yaml<span style=color:#960050;background-color:#1e0010>\</span>snakeyaml<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>1.29</span><span style=color:#960050;background-color:#1e0010>\</span>snakeyaml<span style=color:#f92672>-</span><span style=color:#ae81ff>1.29</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>boot<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>starter<span style=color:#f92672>-</span>json<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>2.6.6</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>starter<span style=color:#f92672>-</span>json<span style=color:#f92672>-</span><span style=color:#ae81ff>2.6.6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>com<span style=color:#960050;background-color:#1e0010>\</span>fasterxml<span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#960050;background-color:#1e0010>\</span>core<span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#f92672>-</span>databind<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>2.13.2.2</span><span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#f92672>-</span>databind<span style=color:#f92672>-</span><span style=color:#ae81ff>2.13.2.2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>com<span style=color:#960050;background-color:#1e0010>\</span>fasterxml<span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#960050;background-color:#1e0010>\</span>core<span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#f92672>-</span>annotations<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>2.13.2</span><span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#f92672>-</span>annotations<span style=color:#f92672>-</span><span style=color:#ae81ff>2.13.2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>com<span style=color:#960050;background-color:#1e0010>\</span>fasterxml<span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#960050;background-color:#1e0010>\</span>core<span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#f92672>-</span>core<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>2.13.2</span><span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#f92672>-</span>core<span style=color:#f92672>-</span><span style=color:#ae81ff>2.13.2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>com<span style=color:#960050;background-color:#1e0010>\</span>fasterxml<span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#960050;background-color:#1e0010>\</span>datatype<span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#f92672>-</span>datatype<span style=color:#f92672>-</span>jdk8<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>2.13.2</span><span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#f92672>-</span>datatype<span style=color:#f92672>-</span>jdk8<span style=color:#f92672>-</span><span style=color:#ae81ff>2.13.2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>com<span style=color:#960050;background-color:#1e0010>\</span>fasterxml<span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#960050;background-color:#1e0010>\</span>datatype<span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#f92672>-</span>datatype<span style=color:#f92672>-</span>jsr310<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>2.13.2</span><span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#f92672>-</span>datatype<span style=color:#f92672>-</span>jsr310<span style=color:#f92672>-</span><span style=color:#ae81ff>2.13.2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>com<span style=color:#960050;background-color:#1e0010>\</span>fasterxml<span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#960050;background-color:#1e0010>\</span>module<span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#f92672>-</span>module<span style=color:#f92672>-</span>parameter<span style=color:#f92672>-</span>names<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>2.13.2</span><span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#f92672>-</span>module<span style=color:#f92672>-</span>parameter<span style=color:#f92672>-</span>names<span style=color:#f92672>-</span><span style=color:#ae81ff>2.13.2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>boot<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>starter<span style=color:#f92672>-</span>tomcat<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>2.6.6</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>starter<span style=color:#f92672>-</span>tomcat<span style=color:#f92672>-</span><span style=color:#ae81ff>2.6.6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>apache<span style=color:#960050;background-color:#1e0010>\</span>tomcat<span style=color:#960050;background-color:#1e0010>\</span>embed<span style=color:#960050;background-color:#1e0010>\</span>tomcat<span style=color:#f92672>-</span>embed<span style=color:#f92672>-</span>core<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>9.0.60</span><span style=color:#960050;background-color:#1e0010>\</span>tomcat<span style=color:#f92672>-</span>embed<span style=color:#f92672>-</span>core<span style=color:#f92672>-</span><span style=color:#ae81ff>9.0.60</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>apache<span style=color:#960050;background-color:#1e0010>\</span>tomcat<span style=color:#960050;background-color:#1e0010>\</span>embed<span style=color:#960050;background-color:#1e0010>\</span>tomcat<span style=color:#f92672>-</span>embed<span style=color:#f92672>-</span>el<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>9.0.60</span><span style=color:#960050;background-color:#1e0010>\</span>tomcat<span style=color:#f92672>-</span>embed<span style=color:#f92672>-</span>el<span style=color:#f92672>-</span><span style=color:#ae81ff>9.0.60</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>apache<span style=color:#960050;background-color:#1e0010>\</span>tomcat<span style=color:#960050;background-color:#1e0010>\</span>embed<span style=color:#960050;background-color:#1e0010>\</span>tomcat<span style=color:#f92672>-</span>embed<span style=color:#f92672>-</span>websocket<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>9.0.60</span><span style=color:#960050;background-color:#1e0010>\</span>tomcat<span style=color:#f92672>-</span>embed<span style=color:#f92672>-</span>websocket<span style=color:#f92672>-</span><span style=color:#ae81ff>9.0.60</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>web<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>5.3.18</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>web<span style=color:#f92672>-</span><span style=color:#ae81ff>5.3.18</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>beans<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>5.3.18</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>beans<span style=color:#f92672>-</span><span style=color:#ae81ff>5.3.18</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>webmvc<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>5.3.18</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>webmvc<span style=color:#f92672>-</span><span style=color:#ae81ff>5.3.18</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>aop<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>5.3.18</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>aop<span style=color:#f92672>-</span><span style=color:#ae81ff>5.3.18</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>context<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>5.3.18</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>context<span style=color:#f92672>-</span><span style=color:#ae81ff>5.3.18</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>expression<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>5.3.18</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>expression<span style=color:#f92672>-</span><span style=color:#ae81ff>5.3.18</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>boot<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>devtools<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>2.6.6</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>devtools<span style=color:#f92672>-</span><span style=color:#ae81ff>2.6.6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>boot<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>2.6.6</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span><span style=color:#ae81ff>2.6.6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>boot<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>autoconfigure<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>2.6.6</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>autoconfigure<span style=color:#f92672>-</span><span style=color:#ae81ff>2.6.6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>projectlombok<span style=color:#960050;background-color:#1e0010>\</span>lombok<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>1.18.22</span><span style=color:#960050;background-color:#1e0010>\</span>lombok<span style=color:#f92672>-</span><span style=color:#ae81ff>1.18.22</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>slf4j<span style=color:#960050;background-color:#1e0010>\</span>slf4j<span style=color:#f92672>-</span>api<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>1.7.36</span><span style=color:#960050;background-color:#1e0010>\</span>slf4j<span style=color:#f92672>-</span>api<span style=color:#f92672>-</span><span style=color:#ae81ff>1.7.36</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>core<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>5.3.18</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>core<span style=color:#f92672>-</span><span style=color:#ae81ff>5.3.18</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>jcl<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>5.3.18</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>jcl<span style=color:#f92672>-</span><span style=color:#ae81ff>5.3.18</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>com<span style=color:#960050;background-color:#1e0010>\</span>google<span style=color:#960050;background-color:#1e0010>\</span>guava<span style=color:#960050;background-color:#1e0010>\</span>guava<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>31.1</span><span style=color:#f92672>-</span>jre<span style=color:#960050;background-color:#1e0010>\</span>guava<span style=color:#f92672>-</span><span style=color:#ae81ff>31.1</span><span style=color:#f92672>-</span>jre<span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>com<span style=color:#960050;background-color:#1e0010>\</span>google<span style=color:#960050;background-color:#1e0010>\</span>guava<span style=color:#960050;background-color:#1e0010>\</span>failureaccess<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>1.0.1</span><span style=color:#960050;background-color:#1e0010>\</span>failureaccess<span style=color:#f92672>-</span><span style=color:#ae81ff>1.0.1</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>com<span style=color:#960050;background-color:#1e0010>\</span>google<span style=color:#960050;background-color:#1e0010>\</span>guava<span style=color:#960050;background-color:#1e0010>\</span>listenablefuture<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>9999.0</span><span style=color:#f92672>-</span>empty<span style=color:#f92672>-</span>to<span style=color:#f92672>-</span>avoid<span style=color:#f92672>-</span>conflict<span style=color:#f92672>-</span>with<span style=color:#f92672>-</span>guava<span style=color:#960050;background-color:#1e0010>\</span>listenablefuture<span style=color:#f92672>-</span><span style=color:#ae81ff>9999.0</span><span style=color:#f92672>-</span>empty<span style=color:#f92672>-</span>to<span style=color:#f92672>-</span>avoid<span style=color:#f92672>-</span>conflict<span style=color:#f92672>-</span>with<span style=color:#f92672>-</span>guava<span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>com<span style=color:#960050;background-color:#1e0010>\</span>google<span style=color:#960050;background-color:#1e0010>\</span>code<span style=color:#960050;background-color:#1e0010>\</span>findbugs<span style=color:#960050;background-color:#1e0010>\</span>jsr305<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>3.0.2</span><span style=color:#960050;background-color:#1e0010>\</span>jsr305<span style=color:#f92672>-</span><span style=color:#ae81ff>3.0.2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>checkerframework<span style=color:#960050;background-color:#1e0010>\</span>checker<span style=color:#f92672>-</span>qual<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>3.12.0</span><span style=color:#960050;background-color:#1e0010>\</span>checker<span style=color:#f92672>-</span>qual<span style=color:#f92672>-</span><span style=color:#ae81ff>3.12.0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>com<span style=color:#960050;background-color:#1e0010>\</span>google<span style=color:#960050;background-color:#1e0010>\</span>errorprone<span style=color:#960050;background-color:#1e0010>\</span>error_prone_annotations<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>2.11.0</span><span style=color:#960050;background-color:#1e0010>\</span>error_prone_annotations<span style=color:#f92672>-</span><span style=color:#ae81ff>2.11.0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>com<span style=color:#960050;background-color:#1e0010>\</span>google<span style=color:#960050;background-color:#1e0010>\</span>j2objc<span style=color:#960050;background-color:#1e0010>\</span>j2objc<span style=color:#f92672>-</span>annotations<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>1.3</span><span style=color:#960050;background-color:#1e0010>\</span>j2objc<span style=color:#f92672>-</span>annotations<span style=color:#f92672>-</span><span style=color:#ae81ff>1.3</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>joda<span style=color:#f92672>-</span>time<span style=color:#960050;background-color:#1e0010>\</span>joda<span style=color:#f92672>-</span>time<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#ae81ff>2.9.9</span><span style=color:#960050;background-color:#1e0010>\</span>joda<span style=color:#f92672>-</span>time<span style=color:#f92672>-</span><span style=color:#ae81ff>2.9.9</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span> com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span><span style=color:#f92672>:</span><span style=color:#ae81ff>22.696</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>1</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span><span style=color:#f92672>:</span><span style=color:#ae81ff>22.696</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>2</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span><span style=color:#f92672>:</span><span style=color:#ae81ff>22.696</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>0</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span><span style=color:#f92672>:</span><span style=color:#ae81ff>23.707</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>5</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>4</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span><span style=color:#f92672>:</span><span style=color:#ae81ff>23.707</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>6</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>5</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span><span style=color:#f92672>:</span><span style=color:#ae81ff>23.707</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>7</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>6</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span><span style=color:#f92672>:</span><span style=color:#ae81ff>24.711</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>13</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>12</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span><span style=color:#f92672>:</span><span style=color:#ae81ff>24.711</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>8</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>7</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span><span style=color:#f92672>:</span><span style=color:#ae81ff>24.711</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>3</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span><span style=color:#f92672>:</span><span style=color:#ae81ff>25.726</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>9</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span><span style=color:#f92672>:</span><span style=color:#ae81ff>25.726</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>12</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>11</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span><span style=color:#f92672>:</span><span style=color:#ae81ff>25.726</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>14</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>13</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span><span style=color:#f92672>:</span><span style=color:#ae81ff>26.738</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>16</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>15</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span><span style=color:#f92672>:</span><span style=color:#ae81ff>26.738</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>10</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span><span style=color:#f92672>:</span><span style=color:#ae81ff>26.738</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>10</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>9</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span><span style=color:#f92672>:</span><span style=color:#ae81ff>27.741</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>18</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>17</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span><span style=color:#f92672>:</span><span style=color:#ae81ff>27.741</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>17</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>16</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span><span style=color:#f92672>:</span><span style=color:#ae81ff>27.741</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>15</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>14</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span><span style=color:#f92672>:</span><span style=color:#ae81ff>28.741</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>19</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>18</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>53</span><span style=color:#f92672>:</span><span style=color:#ae81ff>28.741</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>20</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>19</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Process finished with exit code <span style=color:#ae81ff>0</span>
</span></span></code></pre></div><p>通过结果可以看到，每秒只打印2个数字，就是信号量控制的。</p><h2 id=示例二>示例二</h2><p>同时获取多个许可，释放多个许可，也可以一个一个释放许可。下面代码示例，只有2个并发线程所有，获取后没有了，就类似单线程。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.yanxizhu.demo.concurrency.aqs<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.yanxizhu.demo.concurrency.annotation.ThreadSafety<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> lombok.extern.slf4j.Slf4j<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.ExecutorService<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.Executors<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.Semaphore<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @description: Semaphore-信号量，控制线程并发数，可以获取或释放多个许可
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author: &lt;a href=&#34;mailto:batis@foxmail.com&#34;&gt;清风&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @date: 2022/4/25 20:41
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @version: 1.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@ThreadSafety</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> threadNum <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> currentThreadNum <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//线程池
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        ExecutorService executorService <span style=color:#f92672>=</span> Executors<span style=color:#f92672>.</span><span style=color:#a6e22e>newCachedThreadPool</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//信号量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        Semaphore semaphore <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Semaphore<span style=color:#f92672>(</span>currentThreadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span>threadNum<span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> num <span style=color:#f92672>=</span> i<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>//获取3个许可，需要等3个都执行完了，才释放3个许可
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    semaphore<span style=color:#f92672>.</span><span style=color:#a6e22e>acquire</span><span style=color:#f92672>(</span><span style=color:#ae81ff>3</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                    pringNum<span style=color:#f92672>(</span>num<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>//释放3个许可
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    semaphore<span style=color:#f92672>.</span><span style=color:#a6e22e>release</span><span style=color:#f92672>(</span><span style=color:#ae81ff>3</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span><span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                    log<span style=color:#f92672>.</span><span style=color:#a6e22e>error</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;执行错误【{}】&#34;</span><span style=color:#f92672>,</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>shutdown</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>pringNum</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> num<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;num=【{}】&#34;</span><span style=color:#f92672>,</span> num<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1000</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>输出结果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>56</span><span style=color:#f92672>:</span><span style=color:#ae81ff>17.733</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>0</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>56</span><span style=color:#f92672>:</span><span style=color:#ae81ff>18.740</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>1</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>56</span><span style=color:#f92672>:</span><span style=color:#ae81ff>19.754</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>6</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>5</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>56</span><span style=color:#f92672>:</span><span style=color:#ae81ff>20.755</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>7</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>6</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>56</span><span style=color:#f92672>:</span><span style=color:#ae81ff>21.767</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>10</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>9</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>56</span><span style=color:#f92672>:</span><span style=color:#ae81ff>22.780</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>8</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>7</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>56</span><span style=color:#f92672>:</span><span style=color:#ae81ff>23.791</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>5</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>4</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>56</span><span style=color:#f92672>:</span><span style=color:#ae81ff>24.800</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>9</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>56</span><span style=color:#f92672>:</span><span style=color:#ae81ff>25.801</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>3</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>56</span><span style=color:#f92672>:</span><span style=color:#ae81ff>26.812</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>2</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>56</span><span style=color:#f92672>:</span><span style=color:#ae81ff>27.824</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>11</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>10</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>56</span><span style=color:#f92672>:</span><span style=color:#ae81ff>28.834</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>12</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>11</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>56</span><span style=color:#f92672>:</span><span style=color:#ae81ff>29.847</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>13</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>12</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>56</span><span style=color:#f92672>:</span><span style=color:#ae81ff>30.850</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>14</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>13</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>56</span><span style=color:#f92672>:</span><span style=color:#ae81ff>31.853</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>17</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>16</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>56</span><span style=color:#f92672>:</span><span style=color:#ae81ff>32.863</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>15</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>14</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>56</span><span style=color:#f92672>:</span><span style=color:#ae81ff>33.873</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>16</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>15</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>56</span><span style=color:#f92672>:</span><span style=color:#ae81ff>34.885</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>18</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>17</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>56</span><span style=color:#f92672>:</span><span style=color:#ae81ff>35.885</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>19</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>18</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span><span style=color:#f92672>:</span><span style=color:#ae81ff>56</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36.897</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>20</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>19</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>Disconnected from the target VM<span style=color:#f92672>,</span> address<span style=color:#f92672>:</span> <span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#ae81ff>127.0.0.1</span><span style=color:#f92672>:</span><span style=color:#ae81ff>13050</span><span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#f92672>,</span> transport<span style=color:#f92672>:</span> <span style=color:#960050;background-color:#1e0010>&#39;</span>socket<span style=color:#960050;background-color:#1e0010>&#39;</span>
</span></span></code></pre></div><h2 id=示例三>示例三</h2><p>当线程数超过并发数，就丢失多余的。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.yanxizhu.demo.concurrency.aqs<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.yanxizhu.demo.concurrency.annotation.ThreadSafety<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> lombok.extern.slf4j.Slf4j<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.ExecutorService<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.Executors<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.Semaphore<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @description: Semaphore-信号量，控制线程并发数，超过并发量时掉漆多余线程
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author: &lt;a href=&#34;mailto:batis@foxmail.com&#34;&gt;清风&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @date: 2022/4/25 20:41
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @version: 1.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@ThreadSafety</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SemaphoreDemo3</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> threadNum <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> currentThreadNum <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//线程池
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        ExecutorService executorService <span style=color:#f92672>=</span> Executors<span style=color:#f92672>.</span><span style=color:#a6e22e>newCachedThreadPool</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//信号量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        Semaphore semaphore <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Semaphore<span style=color:#f92672>(</span>currentThreadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span>threadNum<span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> num <span style=color:#f92672>=</span> i<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>//尝试获取许可，获取到才执行
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>semaphore<span style=color:#f92672>.</span><span style=color:#a6e22e>tryAcquire</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                        pringNum<span style=color:#f92672>(</span>num<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                        <span style=color:#75715e>//释放一个许可
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                        semaphore<span style=color:#f92672>.</span><span style=color:#a6e22e>release</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span><span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                    log<span style=color:#f92672>.</span><span style=color:#a6e22e>error</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;执行错误【{}】&#34;</span><span style=color:#f92672>,</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>shutdown</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>pringNum</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> num<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;num=【{}】&#34;</span><span style=color:#f92672>,</span> num<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1000</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>输出结果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ae81ff>21</span><span style=color:#f92672>:</span><span style=color:#ae81ff>04</span><span style=color:#f92672>:</span><span style=color:#ae81ff>48.376</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo3</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>0</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>21</span><span style=color:#f92672>:</span><span style=color:#ae81ff>04</span><span style=color:#f92672>:</span><span style=color:#ae81ff>49.387</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo3</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>1</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>Disconnected from the target VM<span style=color:#f92672>,</span> address<span style=color:#f92672>:</span> <span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#ae81ff>127.0.0.1</span><span style=color:#f92672>:</span><span style=color:#ae81ff>2839</span><span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#f92672>,</span> transport<span style=color:#f92672>:</span> <span style=color:#960050;background-color:#1e0010>&#39;</span>socket<span style=color:#960050;background-color:#1e0010>&#39;</span>
</span></span></code></pre></div><p>只输出2个线程，其它18个线程被丢弃。</p><p>tryAcquire方法重载说明：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>//无参
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>tryAcquire</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> sync<span style=color:#f92672>.</span><span style=color:#a6e22e>nonfairTryAcquireShared</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>)</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//1个参数，获取许可个数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>tryAcquire</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> permits<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>permits <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IllegalArgumentException<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> sync<span style=color:#f92672>.</span><span style=color:#a6e22e>nonfairTryAcquireShared</span><span style=color:#f92672>(</span>permits<span style=color:#f92672>)</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//2个参数，超时时间，单位
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>tryAcquire</span><span style=color:#f92672>(</span><span style=color:#66d9ef>long</span> timeout<span style=color:#f92672>,</span> TimeUnit unit<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> sync<span style=color:#f92672>.</span><span style=color:#a6e22e>tryAcquireSharedNanos</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>,</span> unit<span style=color:#f92672>.</span><span style=color:#a6e22e>toNanos</span><span style=color:#f92672>(</span>timeout<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//3个参数，获取许可个数，超时时间，单位
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>tryAcquire</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> permits<span style=color:#f92672>,</span> <span style=color:#66d9ef>long</span> timeout<span style=color:#f92672>,</span> TimeUnit unit<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>permits <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IllegalArgumentException<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> sync<span style=color:#f92672>.</span><span style=color:#a6e22e>tryAcquireSharedNanos</span><span style=color:#f92672>(</span>permits<span style=color:#f92672>,</span> unit<span style=color:#f92672>.</span><span style=color:#a6e22e>toNanos</span><span style=color:#f92672>(</span>timeout<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=示例四>示例四</h2><p>设置超时时间</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.yanxizhu.demo.concurrency.aqs<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.yanxizhu.demo.concurrency.annotation.ThreadSafety<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> lombok.extern.slf4j.Slf4j<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.ExecutorService<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.Executors<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.Semaphore<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.TimeUnit<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @description: Semaphore-信号量，控制线程并发数，带超时时间限制的
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author: &lt;a href=&#34;mailto:batis@foxmail.com&#34;&gt;清风&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @date: 2022/4/25 20:41
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @version: 1.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@ThreadSafety</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SemaphoreDemo4</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> threadNum <span style=color:#f92672>=</span> <span style=color:#ae81ff>50</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> currentThreadNum <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//线程池
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        ExecutorService executorService <span style=color:#f92672>=</span> Executors<span style=color:#f92672>.</span><span style=color:#a6e22e>newCachedThreadPool</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//信号量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        Semaphore semaphore <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Semaphore<span style=color:#f92672>(</span>currentThreadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span>threadNum<span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> num <span style=color:#f92672>=</span> i<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>//尝试获取许可，获取到才执行，获取超过3秒，就不执行了。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>semaphore<span style=color:#f92672>.</span><span style=color:#a6e22e>tryAcquire</span><span style=color:#f92672>(</span><span style=color:#ae81ff>3000</span><span style=color:#f92672>,</span> TimeUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>MILLISECONDS</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                        pringNum<span style=color:#f92672>(</span>num<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                        <span style=color:#75715e>//释放一个许可
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                        semaphore<span style=color:#f92672>.</span><span style=color:#a6e22e>release</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span><span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                    log<span style=color:#f92672>.</span><span style=color:#a6e22e>error</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;执行错误【{}】&#34;</span><span style=color:#f92672>,</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>shutdown</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>pringNum</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> num<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;num=【{}】&#34;</span><span style=color:#f92672>,</span> num<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1000</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>输出结果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>01</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36.804</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo4</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>0</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>01</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36.804</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo4</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>2</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>01</span><span style=color:#f92672>:</span><span style=color:#ae81ff>36.804</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo4</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>1</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>01</span><span style=color:#f92672>:</span><span style=color:#ae81ff>37.828</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo4</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>3</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>01</span><span style=color:#f92672>:</span><span style=color:#ae81ff>37.828</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>6</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo4</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>5</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>01</span><span style=color:#f92672>:</span><span style=color:#ae81ff>37.828</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>10</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo4</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>9</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>01</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38.843</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>12</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo4</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>11</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>01</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38.843</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>13</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo4</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>12</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>01</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38.843</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>8</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo4</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span><span style=color:#ae81ff>7</span><span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>Disconnected from the target VM<span style=color:#f92672>,</span> address<span style=color:#f92672>:</span> <span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#ae81ff>127.0.0.1</span><span style=color:#f92672>:</span><span style=color:#ae81ff>11385</span><span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#f92672>,</span> transport<span style=color:#f92672>:</span> <span style=color:#960050;background-color:#1e0010>&#39;</span>socket<span style=color:#960050;background-color:#1e0010>&#39;</span>
</span></span></code></pre></div><h1 id=3cyclicbarrier>3、CyclicBarrier</h1><p>允许一组线程相互等待，直到达到某个共同屏障点，直到每个线程都就绪后面的才继续往下执行。和CoutDownLatch相似都是通过计数器来实现的，图从下往上看的。线程释放后可以循环使用，因此也叫循环屏障。CoutDownLatch用户分计算，汇总最后的结果。</p><p><img src=https://cdn.jsdelivr.net/gh/willxwu/CDN@main/images/202204252203522.png alt></p><h2 id=示例一-3>示例一</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.yanxizhu.demo.concurrency.aqs<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> lombok.extern.slf4j.Slf4j<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.BrokenBarrierException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.CyclicBarrier<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.ExecutorService<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.Executors<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @description: CyclicBarrier 实现线程相互等待
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author: &lt;a href=&#34;mailto:batis@foxmail.com&#34;&gt;清风&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @date: 2022/4/25 22:15
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @version: 1.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//定义需要相互等待5个线程，就绪后才执行，后面的代码
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> CyclicBarrier cyclicBarrier <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CyclicBarrier<span style=color:#f92672>(</span><span style=color:#ae81ff>4</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//线程池
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        ExecutorService executorService <span style=color:#f92672>=</span> Executors<span style=color:#f92672>.</span><span style=color:#a6e22e>newCachedThreadPool</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>10</span><span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> threadNum <span style=color:#f92672>=</span> i<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//模式看效果，等待1秒
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1000</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    pringWait<span style=color:#f92672>(</span>threadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    log<span style=color:#f92672>.</span><span style=color:#a6e22e>error</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;执行出错了。。。&#34;</span><span style=color:#f92672>,</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>shutdown</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>pringWait</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> threadNum<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException<span style=color:#f92672>,</span> BrokenBarrierException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//模式看效果，等待1秒
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1000</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;等待中。。。{}&#34;</span><span style=color:#f92672>,</span> threadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//告诉线程每个就绪了，await方法支持传入超时时间
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//可选参数long timeout, TimeUnit unit
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        cyclicBarrier<span style=color:#f92672>.</span><span style=color:#a6e22e>await</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//就绪后才执行
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;开始执行了。。{}&#34;</span><span style=color:#f92672>,</span>threadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>输出结果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Connected to the target VM<span style=color:#f92672>,</span> address<span style=color:#f92672>:</span> <span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#ae81ff>127.0.0.1</span><span style=color:#f92672>:</span><span style=color:#ae81ff>14410</span><span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#f92672>,</span> transport<span style=color:#f92672>:</span> <span style=color:#960050;background-color:#1e0010>&#39;</span>socket<span style=color:#960050;background-color:#1e0010>&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>26</span><span style=color:#f92672>:</span><span style=color:#ae81ff>04.855</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>26</span><span style=color:#f92672>:</span><span style=color:#ae81ff>05.853</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>26</span><span style=color:#f92672>:</span><span style=color:#ae81ff>06.866</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>26</span><span style=color:#f92672>:</span><span style=color:#ae81ff>07.881</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>26</span><span style=color:#f92672>:</span><span style=color:#ae81ff>07.881</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>26</span><span style=color:#f92672>:</span><span style=color:#ae81ff>07.882</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>26</span><span style=color:#f92672>:</span><span style=color:#ae81ff>07.882</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>26</span><span style=color:#f92672>:</span><span style=color:#ae81ff>07.881</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>26</span><span style=color:#f92672>:</span><span style=color:#ae81ff>08.896</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>5</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>26</span><span style=color:#f92672>:</span><span style=color:#ae81ff>09.899</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>26</span><span style=color:#f92672>:</span><span style=color:#ae81ff>10.901</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>26</span><span style=color:#f92672>:</span><span style=color:#ae81ff>11.902</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>7</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>26</span><span style=color:#f92672>:</span><span style=color:#ae81ff>11.902</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>7</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>26</span><span style=color:#f92672>:</span><span style=color:#ae81ff>11.902</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>5</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>26</span><span style=color:#f92672>:</span><span style=color:#ae81ff>11.902</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>26</span><span style=color:#f92672>:</span><span style=color:#ae81ff>11.902</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>26</span><span style=color:#f92672>:</span><span style=color:#ae81ff>12.903</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>26</span><span style=color:#f92672>:</span><span style=color:#ae81ff>13.916</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>9</span>
</span></span><span style=display:flex><span>Disconnected from the target VM<span style=color:#f92672>,</span> address<span style=color:#f92672>:</span> <span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#ae81ff>127.0.0.1</span><span style=color:#f92672>:</span><span style=color:#ae81ff>14410</span><span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#f92672>,</span> transport<span style=color:#f92672>:</span> <span style=color:#960050;background-color:#1e0010>&#39;</span>socket<span style=color:#960050;background-color:#1e0010>&#39;</span>
</span></span></code></pre></div><h2 id=示例二-1>示例二</h2><p>带超时时间的，注意需要trycatch才能不影响后续流程执行。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.yanxizhu.demo.concurrency.aqs<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> lombok.extern.slf4j.Slf4j<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.*<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @description: CyclicBarrier 实现线程相互等待,带超时时间，注意捕获异常，才能继续执行后面的操作
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author: &lt;a href=&#34;mailto:batis@foxmail.com&#34;&gt;清风&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @date: 2022/4/25 22:15
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @version: 1.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//定义需要相互等待5个线程，就绪后才执行，后面的代码
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> CyclicBarrier cyclicBarrier <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CyclicBarrier<span style=color:#f92672>(</span><span style=color:#ae81ff>4</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//线程池
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        ExecutorService executorService <span style=color:#f92672>=</span> Executors<span style=color:#f92672>.</span><span style=color:#a6e22e>newCachedThreadPool</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>10</span><span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> threadNum <span style=color:#f92672>=</span> i<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//模式看效果，等待1秒
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1000</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    pringWait<span style=color:#f92672>(</span>threadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    log<span style=color:#f92672>.</span><span style=color:#a6e22e>error</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;执行出错了。。。&#34;</span><span style=color:#f92672>,</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>shutdown</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>pringWait</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> threadNum<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException<span style=color:#f92672>,</span> BrokenBarrierException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//模式看效果，等待1秒
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1000</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;等待中。。。{}&#34;</span><span style=color:#f92672>,</span> threadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//告诉线程每个就绪了，带超时时间
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            cyclicBarrier<span style=color:#f92672>.</span><span style=color:#a6e22e>await</span><span style=color:#f92672>(</span><span style=color:#ae81ff>2000</span><span style=color:#f92672>,</span> TimeUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>MILLISECONDS</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>            log<span style=color:#f92672>.</span><span style=color:#a6e22e>warn</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;超时了，注意：捕获异常，才能继续执行&#34;</span><span style=color:#f92672>,</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//就绪后才执行
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;开始执行了。。{}&#34;</span><span style=color:#f92672>,</span>threadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>输出结果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>37</span><span style=color:#f92672>:</span><span style=color:#ae81ff>57.786</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>37</span><span style=color:#f92672>:</span><span style=color:#ae81ff>58.797</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>37</span><span style=color:#f92672>:</span><span style=color:#ae81ff>59.797</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> WARN com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>超时了，注意：捕获异常，才能继续执行</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>37</span><span style=color:#f92672>:</span><span style=color:#ae81ff>59.797</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#f92672>]</span> WARN com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>超时了，注意：捕获异常，才能继续执行</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>37</span><span style=color:#f92672>:</span><span style=color:#ae81ff>59.797</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>37</span><span style=color:#f92672>:</span><span style=color:#ae81ff>59.798</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>37</span><span style=color:#f92672>:</span><span style=color:#ae81ff>59.812</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>37</span><span style=color:#f92672>:</span><span style=color:#ae81ff>59.812</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span><span style=color:#f92672>]</span> WARN com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>超时了，注意：捕获异常，才能继续执行</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>37</span><span style=color:#f92672>:</span><span style=color:#ae81ff>59.812</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>00.813</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>00.813</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> WARN com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>超时了，注意：捕获异常，才能继续执行</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>00.813</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>01.828</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>01.828</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span><span style=color:#f92672>]</span> WARN com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>超时了，注意：捕获异常，才能继续执行</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>01.828</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>02.840</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>02.840</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> WARN com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>超时了，注意：捕获异常，才能继续执行</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>02.840</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>03.842</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>03.842</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span><span style=color:#f92672>]</span> WARN com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>超时了，注意：捕获异常，才能继续执行</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>03.842</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>04.855</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>7</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>04.855</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> WARN com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>超时了，注意：捕获异常，才能继续执行</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>04.855</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>7</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>05.870</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>05.870</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span><span style=color:#f92672>]</span> WARN com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>超时了，注意：捕获异常，才能继续执行</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>05.870</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>06.870</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>9</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>06.870</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> WARN com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>超时了，注意：捕获异常，才能继续执行</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>38</span><span style=color:#f92672>:</span><span style=color:#ae81ff>06.870</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>9</span>
</span></span><span style=display:flex><span>Disconnected from the target VM<span style=color:#f92672>,</span> address<span style=color:#f92672>:</span> <span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#ae81ff>127.0.0.1</span><span style=color:#f92672>:</span><span style=color:#ae81ff>2195</span><span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#f92672>,</span> transport<span style=color:#f92672>:</span> <span style=color:#960050;background-color:#1e0010>&#39;</span>socket<span style=color:#960050;background-color:#1e0010>&#39;</span>
</span></span></code></pre></div><h2 id=示例三-1>示例三</h2><p>构造可以传入runable线程，优先执行。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.yanxizhu.demo.concurrency.aqs<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> lombok.extern.slf4j.Slf4j<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.BrokenBarrierException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.CyclicBarrier<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.ExecutorService<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.Executors<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @description: CyclicBarrier 实现线程相互等待，CyclicBarrier可以传入runable线程，优先执行该部分代码
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author: &lt;a href=&#34;mailto:batis@foxmail.com&#34;&gt;清风&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @date: 2022/4/25 22:15
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @version: 1.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//定义需要相互等待5个线程，就绪后才执行，后面的代码
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> CyclicBarrier cyclicBarrier <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CyclicBarrier<span style=color:#f92672>(</span><span style=color:#ae81ff>4</span><span style=color:#f92672>,</span> <span style=color:#f92672>()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;相互等待线程都就绪后，这部分代码先执行&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//线程池
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        ExecutorService executorService <span style=color:#f92672>=</span> Executors<span style=color:#f92672>.</span><span style=color:#a6e22e>newCachedThreadPool</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>10</span><span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> threadNum <span style=color:#f92672>=</span> i<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//模式看效果，等待1秒
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1000</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    pringWait<span style=color:#f92672>(</span>threadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    log<span style=color:#f92672>.</span><span style=color:#a6e22e>error</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;执行出错了。。。&#34;</span><span style=color:#f92672>,</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>shutdown</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>pringWait</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> threadNum<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException<span style=color:#f92672>,</span> BrokenBarrierException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//模式看效果，等待1秒
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1000</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;等待中。。。{}&#34;</span><span style=color:#f92672>,</span> threadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//告诉线程每个就绪了，await方法支持传入超时时间
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//可选参数long timeout, TimeUnit unit
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        cyclicBarrier<span style=color:#f92672>.</span><span style=color:#a6e22e>await</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//就绪后才执行
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;开始执行了。。{}&#34;</span><span style=color:#f92672>,</span>threadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>输出结果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>42</span><span style=color:#f92672>:</span><span style=color:#ae81ff>09.313</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>42</span><span style=color:#f92672>:</span><span style=color:#ae81ff>10.313</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>42</span><span style=color:#f92672>:</span><span style=color:#ae81ff>11.318</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>42</span><span style=color:#f92672>:</span><span style=color:#ae81ff>12.320</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>42</span><span style=color:#f92672>:</span><span style=color:#ae81ff>12.320</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>相互等待线程都就绪后，这部分代码先执行</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>42</span><span style=color:#f92672>:</span><span style=color:#ae81ff>12.320</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>42</span><span style=color:#f92672>:</span><span style=color:#ae81ff>12.320</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>42</span><span style=color:#f92672>:</span><span style=color:#ae81ff>12.320</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>42</span><span style=color:#f92672>:</span><span style=color:#ae81ff>12.320</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>42</span><span style=color:#f92672>:</span><span style=color:#ae81ff>13.325</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>5</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>42</span><span style=color:#f92672>:</span><span style=color:#ae81ff>14.339</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>42</span><span style=color:#f92672>:</span><span style=color:#ae81ff>15.353</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>42</span><span style=color:#f92672>:</span><span style=color:#ae81ff>16.355</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>7</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>42</span><span style=color:#f92672>:</span><span style=color:#ae81ff>16.355</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>相互等待线程都就绪后，这部分代码先执行</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>42</span><span style=color:#f92672>:</span><span style=color:#ae81ff>16.355</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>7</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>42</span><span style=color:#f92672>:</span><span style=color:#ae81ff>16.355</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>5</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>42</span><span style=color:#f92672>:</span><span style=color:#ae81ff>16.355</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>42</span><span style=color:#f92672>:</span><span style=color:#ae81ff>16.355</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>开始执行了。。</span><span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>42</span><span style=color:#f92672>:</span><span style=color:#ae81ff>17.358</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span><span style=color:#f92672>:</span><span style=color:#ae81ff>42</span><span style=color:#f92672>:</span><span style=color:#ae81ff>18.372</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>等待中。。。</span><span style=color:#ae81ff>9</span>
</span></span></code></pre></div><p>总结：注意CoutDownLatch与CyclicBarrier的不同，对别使用。</p></div><div class=post-footer></div></article></main></body></html>