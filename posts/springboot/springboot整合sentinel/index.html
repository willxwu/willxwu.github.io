<!doctype html><html lang=en><head><title>// willxwu</title><link rel="shortcut icon" href=/favicon.ico><meta charset=utf-8><meta name=generator content="Hugo 0.115.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="willxwu"><meta name=description content><link rel=stylesheet href=https://willxwu.github.io/css/main.min.68e582a4d4ed824d6b7e3b5b37cae47eb3779bd631046379d0e68b38230cc3e2.css><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="SpringBoot整合Sentinel 1、引入依赖 <dependency> <groupId>com.alibaba.cloud</groupId> <artifactId>spring-cloud-starter-alibaba-sentinel</artifactId> </dependency> 2、下载安装Sentinel可视化控制台 下载自己引入sentinel对应的核心包版本，下载地址：https://github.com/alibaba/Sentinel/releases
运行Sentinel可视化控制台
java -jar sentinel-dashboard-1.8.1.jar 注意自己的版本。
打开http://127.0.0.1:8080/，默认账号密码sentinel
3、微服务配置sentinel application.yml
spring: cloud: sentinel: transport: port: 8719 dashboard: localhost:8080 port: 8719端口随意，只要不被占用，用于各微服务与控制台通讯。
4、查看监控信息 启动微服务，随意访问一个接口，Sentinel控制台即可看到实施监控信息。
5、启用相关功能 可在Sentinel控制台调整相应功能。默认所有流控设置都是保存在内存中，重启服务就没有了。
6、添加监控图标 引入审计start，sentinel会自动根据spring-boot-starter-actuator监控。
<dependency> <groupId>org.springframework.boot</groupId> <artifactId>spring-boot-starter-actuator</artifactId> <version>2.6.1</version> </dependency> 开启监控图标
management.endpoints.web.exposure.include=* 7、自定义流控返回提示信息 import com.alibaba.csp.sentinel.adapter.spring.webmvc.callback.BlockExceptionHandler; import com.alibaba.csp.sentinel.slots.block.BlockException; import com.alibaba.fastjson.JSON; import com.yanxizhu.common.utils.R; import org.springframework.context.annotation.Configuration; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; /** * @description: Sentinel流控信息提示自定i * @author: <a href=&#34;mailto:batis@foxmail.com&#34;>清风</a> * @date: 2022/3/13 20:14 * @version: 1.0 */ @Configuration public class MySentinelConfig implements BlockExceptionHandler { @Override public void handle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, BlockException e) throws Exception { R r = R."><meta property="og:title" content><meta property="og:description" content="SpringBoot整合Sentinel 1、引入依赖 <dependency> <groupId>com.alibaba.cloud</groupId> <artifactId>spring-cloud-starter-alibaba-sentinel</artifactId> </dependency> 2、下载安装Sentinel可视化控制台 下载自己引入sentinel对应的核心包版本，下载地址：https://github.com/alibaba/Sentinel/releases
运行Sentinel可视化控制台
java -jar sentinel-dashboard-1.8.1.jar 注意自己的版本。
打开http://127.0.0.1:8080/，默认账号密码sentinel
3、微服务配置sentinel application.yml
spring: cloud: sentinel: transport: port: 8719 dashboard: localhost:8080 port: 8719端口随意，只要不被占用，用于各微服务与控制台通讯。
4、查看监控信息 启动微服务，随意访问一个接口，Sentinel控制台即可看到实施监控信息。
5、启用相关功能 可在Sentinel控制台调整相应功能。默认所有流控设置都是保存在内存中，重启服务就没有了。
6、添加监控图标 引入审计start，sentinel会自动根据spring-boot-starter-actuator监控。
<dependency> <groupId>org.springframework.boot</groupId> <artifactId>spring-boot-starter-actuator</artifactId> <version>2.6.1</version> </dependency> 开启监控图标
management.endpoints.web.exposure.include=* 7、自定义流控返回提示信息 import com.alibaba.csp.sentinel.adapter.spring.webmvc.callback.BlockExceptionHandler; import com.alibaba.csp.sentinel.slots.block.BlockException; import com.alibaba.fastjson.JSON; import com.yanxizhu.common.utils.R; import org.springframework.context.annotation.Configuration; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; /** * @description: Sentinel流控信息提示自定i * @author: <a href=&#34;mailto:batis@foxmail.com&#34;>清风</a> * @date: 2022/3/13 20:14 * @version: 1.0 */ @Configuration public class MySentinelConfig implements BlockExceptionHandler { @Override public void handle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, BlockException e) throws Exception { R r = R."><meta property="og:type" content="article"><meta property="og:url" content="https://willxwu.github.io/posts/springboot/springboot%E6%95%B4%E5%90%88sentinel/"><meta property="article:section" content="posts"></head><body><header class=app-header><a href=https://willxwu.github.io/><img class=app-header-avatar src=/avatar.jpg alt=willxwu></a><h1>willxwu</h1><p>生活哪有那么复杂，简单甚好。@万般滋味，皆是生活。</p><div class=app-header-social><a target=_blank href=https://github.com/willxwu rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a target=_blank href=https://twitter.com/i2school rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><title>twitter</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a target=_blank href=https://twitter.com/willxwu rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-umbrella"><title>umbrella</title><path d="M23 12A11.05 11.05.0 001 12zm-5 7a3 3 0 01-6 0v-7"/></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title></h1><div class=post-meta><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Jan 1, 0001</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>2 min read</div></div></header><div class=post-content><h1 id=springboot整合sentinel>SpringBoot整合Sentinel</h1><h1 id=1引入依赖>1、引入依赖</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.alibaba.cloud<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-sentinel<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><h1 id=2下载安装sentinel可视化控制台>2、下载安装Sentinel可视化控制台</h1><p><a href=https://github.com/alibaba/Sentinel/releases><strong>下载</strong></a>自己引入sentinel对应的核心包版本，下载地址：https://github.com/alibaba/Sentinel/releases</p><p><strong>运行</strong>Sentinel可视化控制台</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>java -jar sentinel-dashboard-1.8.1.jar
</span></span></code></pre></div><p>注意自己的版本。</p><p><strong>打开</strong>http://127.0.0.1:8080/，默认账号密码sentinel</p><h1 id=3微服务配置sentinel>3、微服务配置sentinel</h1><p>application.yml</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spring</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>cloud</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>sentinel</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>transport</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>port</span>: <span style=color:#ae81ff>8719</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>dashboard</span>: <span style=color:#ae81ff>localhost:8080</span>
</span></span></code></pre></div><p>port: 8719端口随意，只要不被占用，用于各微服务与控制台通讯。</p><h1 id=4查看监控信息>4、查看监控信息</h1><p>启动微服务，随意访问一个接口，Sentinel控制台即可看到实施监控信息。</p><h1 id=5启用相关功能>5、启用相关功能</h1><p>可在Sentinel控制台调整相应功能。默认所有流控设置都是保存在内存中，重启服务就没有了。</p><h1 id=6添加监控图标>6、添加监控图标</h1><p>引入审计start，sentinel会自动根据spring-boot-starter-actuator监控。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-actuator<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;version&gt;</span>2.6.1<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>开启监控图标</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>management.endpoints.web.exposure.include=*</span>
</span></span></code></pre></div><h1 id=7自定义流控返回提示信息>7、自定义流控返回提示信息</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> com.alibaba.csp.sentinel.adapter.spring.webmvc.callback.BlockExceptionHandler<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.alibaba.csp.sentinel.slots.block.BlockException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.alibaba.fastjson.JSON<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.yanxizhu.common.utils.R<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.context.annotation.Configuration<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.http.HttpServletRequest<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.http.HttpServletResponse<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @description: Sentinel流控信息提示自定i
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author: &lt;a href=&#34;mailto:batis@foxmail.com&#34;&gt;清风&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @date: 2022/3/13 20:14
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @version: 1.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MySentinelConfig</span> <span style=color:#66d9ef>implements</span> BlockExceptionHandler <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>handle</span><span style=color:#f92672>(</span>HttpServletRequest httpServletRequest<span style=color:#f92672>,</span> HttpServletResponse httpServletResponse<span style=color:#f92672>,</span> BlockException e<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        R r <span style=color:#f92672>=</span> R<span style=color:#f92672>.</span><span style=color:#a6e22e>error</span><span style=color:#f92672>(</span><span style=color:#ae81ff>10000</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;自定义提示&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        httpServletResponse<span style=color:#f92672>.</span><span style=color:#a6e22e>setContentType</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;application/json;charset=utf-8&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        httpServletResponse<span style=color:#f92672>.</span><span style=color:#a6e22e>getWriter</span><span style=color:#f92672>().</span><span style=color:#a6e22e>write</span><span style=color:#f92672>(</span>JSON<span style=color:#f92672>.</span><span style=color:#a6e22e>toJSONString</span><span style=color:#f92672>(</span>r<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>限流规则可参考<a href=https://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel>官网限流文档</a>。</p><p>每一个微服务都有一个自己的自定义流控返回提示信息，其它配置一样，只是提示信息不同。</p><h1 id=8熔断降级>8、熔断、降级</h1><p>针对Feign远程调用熔断</p><p>引入Feign远程调用依赖</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>&lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>打开 Sentinel 对 Feign 的支持：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>feign.sentinel.enabled=true</span>
</span></span></code></pre></div><p>熔断实现</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@FeignClient</span><span style=color:#f92672>(</span>value <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;renren-fast&#34;</span><span style=color:#f92672>,</span>fallback <span style=color:#f92672>=</span> SeckillFeignServiceFallBack<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>CardFeignService</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/sys/user/list&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> R <span style=color:#a6e22e>list</span><span style=color:#f92672>(</span><span style=color:#a6e22e>@RequestParam</span> Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> Object<span style=color:#f92672>&gt;</span> params<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>熔断回调</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@S1f4j</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SeckillFeignServiceFallBack</span> <span style=color:#66d9ef>implements</span> SeckillFeignService<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span> <span style=color:#66d9ef>public</span> R <span style=color:#a6e22e>getskuseckillInfo</span><span style=color:#f92672>(</span>Long skuld<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;熔断方法调用...getskuSecki11Info&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> R<span style=color:#f92672>.</span><span style=color:#a6e22e>error</span><span style=color:#f92672>(</span>com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>family</span><span style=color:#f92672>.</span><span style=color:#a6e22e>common</span><span style=color:#f92672>.</span><span style=color:#a6e22e>exception</span><span style=color:#f92672>.</span><span style=color:#a6e22e>BizCodeEnume</span><span style=color:#f92672>.</span><span style=color:#a6e22e>TOO_MWANY_REQUEST</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getCode</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>family</span><span style=color:#f92672>.</span><span style=color:#a6e22e>common</span><span style=color:#f92672>.</span><span style=color:#a6e22e>exception</span><span style=color:#f92672>.</span><span style=color:#a6e22e>BizCodeEnume</span><span style=color:#f92672>.</span><span style=color:#a6e22e>TOO_MANY_REQUEST</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getAsg</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p><strong>调用方：</strong></p><p>手动指定远程服务的降级策略。远程服务被降级处理。触发我们的熔断回调方法。</p><p><strong>提供方：</strong></p><p>超大浏览的时侯，必须牺牲一些远程服务。在服务的提供方（远程服务）指定降级策略；提供方是在运行。但是不运行自己的业务逻辑，返回的是默认的降级数据（限流的数据）。</p><p><code>@SentinelResource</code> 注解用来标识资源是否被限流、降级。上述例子上该注解的属性 <code>sayHello</code> 表示资源名。</p><p><code>@SentinelResource</code> 还提供了其它额外的属性如 <code>blockHandler</code>，<code>blockHandlerClass</code>，<code>fallback</code> 用于表示限流或降级的操作（注意有方法签名要求），更多内容可以参考 <a href=https://github.com/alibaba/Sentinel/wiki/%E6%B3%A8%E8%A7%A3%E6%94%AF%E6%8C%81>Sentinel 注解支持文档</a>。若不配置 <code>blockHandler</code>、<code>fallback</code> 等函数，则被流控降级时方法会直接抛出对应的 BlockException；若方法未定义 <code>throws BlockException</code> 则会被 JVM 包装一层 <code>UndeclaredThrowableException</code>。</p><blockquote><p>注：一般推荐将 <code>@SentinelResource</code> 注解加到服务实现上，而在 Web 层直接使用 Spring Cloud Alibaba 自带的 Web 埋点适配。Sentinel Web 适配同样支持配置自定义流控处理逻辑，参考 <a href=https://github.com/alibaba/Sentinel/wiki/%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6%E7%9A%84%E9%80%82%E9%85%8D#web-%E9%80%82%E9%85%8D>相关文档</a>。</p></blockquote><h1 id=9自定义受保护的资源>9、自定义受保护的资源</h1><p>1）、代码
try（Entry entry =SphU.entry（&ldquo;seckillSkus&rdquo;））（
/业务逻辑
catch（Execption e）（}
2）、基于注解。
eSentinelResource（value =&ldquo;getCurrentSeckiLLSkusResource&rdquo;，blockHandler =&ldquo;blockHandler&rdquo;）
无论是1，2方式一定要配置被限流以后的默认返回</p><p>注：一般推荐将 <code>@SentinelResource</code> 注解加到服务实现上，而在 Web 层直接使用 Spring Cloud Alibaba 自带的 Web 埋点适配。Sentinel Web 适配同样支持配置自定义流控处理逻辑，参考 <a href=https://github.com/alibaba/Sentinel/wiki/%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6%E7%9A%84%E9%80%82%E9%85%8D#web-%E9%80%82%E9%85%8D>相关文档</a>。</p><h1 id=10网关限流>10、网关限流</h1><p>引入网关sentinel依赖</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.alibaba.csp<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>sentinel-spring-cloud-gateway-adapter<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>x.y.z<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>使用时只需注入对应的 <code>SentinelGatewayFilter</code> 实例以及 <code>SentinelGatewayBlockExceptionHandler</code> 实例即可（若使用了 Spring Cloud Alibaba Sentinel，则只需按照<a href=https://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel#spring-cloud-gateway-%E6%94%AF%E6%8C%81>文档</a>进行配置即可，无需自己加 Configuration）。</p><p>更多网关限流可<a href=https://github.com/alibaba/Sentinel/wiki/%E7%BD%91%E5%85%B3%E9%99%90%E6%B5%81>参考官方文档</a></p><h1 id=11定制网关流控返回>11、定制网关流控返回</h1><p>参考<a href=https://github.com/alibaba/Sentinel/wiki/%E7%BD%91%E5%85%B3%E9%99%90%E6%B5%81>官方文档</a></p></div><div class=post-footer></div></article></main></body></html>