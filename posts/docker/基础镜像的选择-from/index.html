<!doctype html><html lang=en><head><title>// 归去来兮</title><link rel="shortcut icon" href=/favicon.ico><meta charset=utf-8><meta name=generator content="Hugo 0.117.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="willxwu"><meta name=description content><link rel=stylesheet href=https://willxwu.github.io/css/main.min.68e582a4d4ed824d6b7e3b5b37cae47eb3779bd631046379d0e68b38230cc3e2.css><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="基础镜像的选择 (FROM) 官方镜像优于非官方的镜像，如果没有官方镜像，则尽量选择Dockerfile开源的 固定版本tag而不是每次都使用latest 尽量选择体积小的镜像 空镜像：scratch
最小镜像：alpine
通过 RUN 执行指令 RUN 主要用于在Image里执行指令，比如安装软件，下载文件等。
FROM ubuntu:20.04 RUN apt-get update RUN apt-get install -y wget RUN wget https://github.com/ipinfo/cli/releases/download/ipinfo-2.0.1/ipinfo_2.0.1_linux_amd64.tar.gz RUN tar zxf ipinfo_2.0.1_linux_amd64.tar.gz RUN mv ipinfo_2.0.1_linux_amd64 /usr/bin/ipinfo RUN rm -rf ipinfo_2.0.1_linux_amd64.tar.gz 每执行一次RUN执行，就会新产生一个分层。
一般使用，优化后的执行命令：
FROM ubuntu:20.04 RUN apt-get update && \ apt-get install -y wget && \ wget https://github.com/ipinfo/cli/releases/download/ipinfo-2.0.1/ipinfo_2.0.1_linux_amd64.tar.gz && \ tar zxf ipinfo_2.0.1_linux_amd64.tar.gz && \ mv ipinfo_2.0.1_linux_amd64 /usr/bin/ipinfo && \ rm -rf ipinfo_2.0.1_linux_amd64.tar.gz &&：指令拼接"><meta property="og:title" content><meta property="og:description" content="基础镜像的选择 (FROM) 官方镜像优于非官方的镜像，如果没有官方镜像，则尽量选择Dockerfile开源的 固定版本tag而不是每次都使用latest 尽量选择体积小的镜像 空镜像：scratch
最小镜像：alpine
通过 RUN 执行指令 RUN 主要用于在Image里执行指令，比如安装软件，下载文件等。
FROM ubuntu:20.04 RUN apt-get update RUN apt-get install -y wget RUN wget https://github.com/ipinfo/cli/releases/download/ipinfo-2.0.1/ipinfo_2.0.1_linux_amd64.tar.gz RUN tar zxf ipinfo_2.0.1_linux_amd64.tar.gz RUN mv ipinfo_2.0.1_linux_amd64 /usr/bin/ipinfo RUN rm -rf ipinfo_2.0.1_linux_amd64.tar.gz 每执行一次RUN执行，就会新产生一个分层。
一般使用，优化后的执行命令：
FROM ubuntu:20.04 RUN apt-get update && \ apt-get install -y wget && \ wget https://github.com/ipinfo/cli/releases/download/ipinfo-2.0.1/ipinfo_2.0.1_linux_amd64.tar.gz && \ tar zxf ipinfo_2.0.1_linux_amd64.tar.gz && \ mv ipinfo_2.0.1_linux_amd64 /usr/bin/ipinfo && \ rm -rf ipinfo_2.0.1_linux_amd64.tar.gz &&：指令拼接"><meta property="og:type" content="article"><meta property="og:url" content="https://willxwu.github.io/posts/docker/%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F%E7%9A%84%E9%80%89%E6%8B%A9-from/"><meta property="article:section" content="posts"></head><body><header class=app-header><a href=https://willxwu.github.io/><img class=app-header-avatar src=/avatar.jpg alt=willxwu></a><h1>归去来兮</h1><nav class=app-header-menu><a class=app-header-menu-item href=/archives/>归档</a>
-
<a class=app-header-menu-item href=/tags/>标签</a>
-
<a class=app-header-menu-item href=/links/>友链</a></nav><p>万般滋味，皆是生活。@生活哪有那么复杂，简单甚好。</p><div class=app-header-social><a target=_blank href=https://github.com/willxwu rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a target=_blank href=https://twitter.com/i2school rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><title>twitter</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a target=_blank href=https://yanxizhu.com rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-link"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title></h1><div class=post-meta><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Jan 1, 0001</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>3 min read</div></div></header><div class=post-content><h1 id=基础镜像的选择-from>基础镜像的选择 (FROM)</h1><ul><li>官方镜像优于非官方的镜像，如果没有官方镜像，则尽量选择Dockerfile开源的</li><li>固定版本tag而不是每次都使用latest</li><li>尽量选择体积小的镜像</li></ul><p>空镜像：scratch</p><p>最小镜像：alpine</p><h1 id=通过-run-执行指令>通过 RUN 执行指令</h1><p><code>RUN</code> 主要用于在Image里执行指令，比如安装软件，下载文件等。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>FROM ubuntu:20.04
</span></span><span style=display:flex><span>RUN apt-get update
</span></span><span style=display:flex><span>RUN apt-get install -y wget
</span></span><span style=display:flex><span>RUN wget https://github.com/ipinfo/cli/releases/download/ipinfo-2.0.1/ipinfo_2.0.1_linux_amd64.tar.gz
</span></span><span style=display:flex><span>RUN tar zxf ipinfo_2.0.1_linux_amd64.tar.gz
</span></span><span style=display:flex><span>RUN mv ipinfo_2.0.1_linux_amd64 /usr/bin/ipinfo
</span></span><span style=display:flex><span>RUN rm -rf ipinfo_2.0.1_linux_amd64.tar.gz
</span></span></code></pre></div><p><strong>每执行一次RUN执行，就会新产生一个分层。</strong></p><p><strong>一般使用，优化后的执行命令</strong>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>FROM ubuntu:20.04
</span></span><span style=display:flex><span>RUN apt-get update <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    apt-get install -y wget <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    wget https://github.com/ipinfo/cli/releases/download/ipinfo-2.0.1/ipinfo_2.0.1_linux_amd64.tar.gz <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    tar zxf ipinfo_2.0.1_linux_amd64.tar.gz <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    mv ipinfo_2.0.1_linux_amd64 /usr/bin/ipinfo <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    rm -rf ipinfo_2.0.1_linux_amd64.tar.gz
</span></span></code></pre></div><p>&&：指令拼接</p><p>\：命令换行。</p><p>只执行了一次RUN，则只会产生一个分层。</p><h1 id=文件复制和目录操作>文件复制和目录操作</h1><p>(ADD,COPY,WORKDIR)</p><p>往镜像里复制文件有两种方式，<code>COPY</code> 和 <code>ADD</code> , 我们来看一下两者的不同。</p><h2 id=复制普通文件>复制普通文件</h2><p><code>COPY</code> 和 <code>ADD</code> 都可以把local的一个文件复制到镜像里，如果目标目录不存在，则会自动创建。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>FROM python:3.9.5-alpine3.13
</span></span><span style=display:flex><span>COPY hello.py /app/hello.py
</span></span></code></pre></div><p>比如把本地的 hello.py 复制到 /app 目录下。 /app这个folder不存在，则会自动创建。</p><h2 id=复制压缩文件>复制压缩文件</h2><p><code>ADD</code> 比 COPY高级一点的地方就是，如果复制的是一个gzip等压缩文件时，ADD会帮助我们自动去解压缩文件。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>FROM python:3.9.5-alpine3.13
</span></span><span style=display:flex><span>ADD hello.tar.gz /app/
</span></span></code></pre></div><p><strong>所有的文件复制均使用 COPY 指令，仅在需要自动解压缩的场合使用 ADD。</strong></p><p>注意：对应文件的权限复制到基础镜像里面后权限一样。</p><h2 id=目录切换>目录切换</h2><p>WORKDIR：目录切换，类似cd的操作。比cd好的是，<strong>没有目录时，会帮自动创建。</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>FROM python:3.9.5-alpine3.13
</span></span><span style=display:flex><span>WORKDIR /app
</span></span><span style=display:flex><span>COPY hello.py hello.py
</span></span></code></pre></div><p>WORKDIR切换目录后，copy默认copy到切换后的app目录下。</p><h1 id=构建参数和环境变量-arg-vs-env>构建参数和环境变量 (ARG vs ENV)</h1><p><code>ARG</code> 和 <code>ENV</code> 是经常容易被混淆的两个Dockerfile的语法，都可以用来设置一个“变量”。 但实际上两者有很多的不同。</p><p>例子：安装某个特定版本软件时，需要对版本进行升级，就可以定义参数变量，方便后续升级，直接改版本号即可。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> ubuntu:20.04</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> apt-get update <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    apt-get install -y wget <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    wget https://github.com/ipinfo/cli/releases/download/ipinfo-2.0.1/ipinfo_2.0.1_linux_amd64.tar.gz <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    tar zxf ipinfo_2.0.1_linux_amd64.tar.gz <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    mv ipinfo_2.0.1_linux_amd64 /usr/bin/ipinfo <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    rm -rf ipinfo_2.0.1_linux_amd64.tar.gz<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>上面是没有使用变量时，每次升级就需要改版本号2.0.1，这样会修改很多地方，这时就可以定义参数变量，之后升级改一个地方就可以了。</p><h2 id=env变量>ENV变量</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> ubuntu:20.04</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> VERSION<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>.0.1<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> apt-get update <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    apt-get install -y wget <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    wget https://github.com/ipinfo/cli/releases/download/ipinfo-<span style=color:#e6db74>${</span>VERSION<span style=color:#e6db74>}</span>/ipinfo_<span style=color:#e6db74>${</span>VERSION<span style=color:#e6db74>}</span>_linux_amd64.tar.gz <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    tar zxf ipinfo_<span style=color:#e6db74>${</span>VERSION<span style=color:#e6db74>}</span>_linux_amd64.tar.gz <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    mv ipinfo_<span style=color:#e6db74>${</span>VERSION<span style=color:#e6db74>}</span>_linux_amd64 /usr/bin/ipinfo <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    rm -rf ipinfo_<span style=color:#e6db74>${</span>VERSION<span style=color:#e6db74>}</span>_linux_amd64.tar.gz<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h2 id=arg变量>ARG变量</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> ubuntu:20.04</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ARG</span> VERSION<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>.0.1<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> apt-get update <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    apt-get install -y wget <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    wget https://github.com/ipinfo/cli/releases/download/ipinfo-<span style=color:#e6db74>${</span>VERSION<span style=color:#e6db74>}</span>/ipinfo_<span style=color:#e6db74>${</span>VERSION<span style=color:#e6db74>}</span>_linux_amd64.tar.gz <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    tar zxf ipinfo_<span style=color:#e6db74>${</span>VERSION<span style=color:#e6db74>}</span>_linux_amd64.tar.gz <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    mv ipinfo_<span style=color:#e6db74>${</span>VERSION<span style=color:#e6db74>}</span>_linux_amd64 /usr/bin/ipinfo <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    rm -rf ipinfo_<span style=color:#e6db74>${</span>VERSION<span style=color:#e6db74>}</span>_linux_amd64.tar.gz<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>使用时，都是${变量名}这样使用。如果要改版本，这样直接改VERSION=新版本号就可以了。</p><h2 id=env与arg区别>ENV与ARG区别</h2><p>ARG：只作用域镜像构建过程中，镜像环境中是没有该参数的，后续容器中不能使用改参数变量。build镜像时<strong>可以使用参数&ndash;build-arg动态改变参数值</strong>。</p><p>例如：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker image build -f .<span style=color:#ae81ff>\D</span>ockerfile-arg -t ipinfo-arg-2.0.0 --build-arg VERSION<span style=color:#f92672>=</span>2.0.0 .
</span></span></code></pre></div><p>ENV：会将参数设置到镜像中，通过env可以看到环境变量中有对应的参数，后续容器中也可以使用这些参数变量。不能动态改值。</p><h2 id=使用场景>使用场景</h2><p>ARG主要用于关注build镜像的过程。</p><p>ENV主要用于后续容器中使用。</p><h1 id=容器启动时默认执行的命令-cmd>容器启动时默认执行的命令 CMD</h1><p>CMD可以用来设置容器启动时默认会执行的命令。</p><ul><li>容器启动时默认执行的命令</li><li>如果docker container run启动容器时指定了其它命令，则CMD命令会被忽略</li><li>如果定义了多个CMD，只有最后一个会被执行。</li></ul><p>1、<strong>清理后台已经停止的全部容器：</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker system prune -f
</span></span></code></pre></div><p>也可以一个一个清理</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docekr container rm 容器名称
</span></span></code></pre></div><p>2、<strong>删除没有用到的全部镜像</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker image prune -a
</span></span></code></pre></div><p>当没有定义CMD命令时，会默认进入到shell是因为在ubuntu的基础镜像里有定义CMD。</p><p><strong>如果想一次行运行容器，运行完后自动删除容器：只需要在运行容器时加参数&ndash;rm即可</strong>。</p><h1 id=容器启动命令-entrypoint>容器启动命令 ENTRYPOINT</h1><p>ENTRYPOINT 也可以设置容器启动时要执行的命令，但是和CMD是有区别的。</p><ul><li><code>CMD</code> 设置的命令，可以在docker container run 时传入其它命令，覆盖掉 <code>CMD</code> 的命令，但是 <code>ENTRYPOINT</code> 所设置的命令是一定会被执行的。</li><li><code>ENTRYPOINT</code> 和 <code>CMD</code> 可以联合使用，<code>ENTRYPOINT</code> 设置执行的命令，CMD传递参数。</li></ul><p>1、CMD命令的Dockerfile，build成一个叫 <code>demo-cmd</code> 的镜象。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>FROM ubuntu:20.04
</span></span><span style=display:flex><span>CMD <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;echo&#34;</span>, <span style=color:#e6db74>&#34;hello docker&#34;</span><span style=color:#f92672>]</span>
</span></span></code></pre></div><p>2、ENTRYPOINT命令的Dockerfile，build成一个叫 <code>demo-entrypoint</code> 的镜象。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>FROM ubuntu:20.04
</span></span><span style=display:flex><span>ENTRYPOINT <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;echo&#34;</span>, <span style=color:#e6db74>&#34;hello docker&#34;</span><span style=color:#f92672>]</span>
</span></span></code></pre></div><p>比较：</p><p><strong>CMD</strong>的镜像，如果执行创建容器，不指定运行时的命令，则会默认执行CMD所定义的命令，打印出hello docker</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker container run -it --rm demo-cmd
</span></span><span style=display:flex><span>hello docker
</span></span></code></pre></div><p>如果我们docker container run的时候指定命令，则该命令会覆盖掉CMD的命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker container run -it --rm demo-cmd echo <span style=color:#e6db74>&#34;hello world&#34;</span>
</span></span><span style=display:flex><span>hello world
</span></span></code></pre></div><p><strong>ENTRYPOINT</strong>的容器里ENTRYPOINT所定义的命令则无法覆盖，一定会执行：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker container run -it --rm demo-entrypoint
</span></span><span style=display:flex><span>hello docker
</span></span><span style=display:flex><span>$ docker container run -it --rm demo-entrypoint echo <span style=color:#e6db74>&#34;hello world&#34;</span>
</span></span><span style=display:flex><span>hello docker echo hello world
</span></span></code></pre></div><p>会将echo &ldquo;hello world"当作参数传入。</p><p>3、CMD作为参数参数传入ENTRYPOINT，Dockerfile如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>FROM ubuntu:21.04
</span></span><span style=display:flex><span>ENTRYPOINT <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;echo&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>CMD <span style=color:#f92672>[]</span>
</span></span></code></pre></div><p>将3编译成叫demoboth的镜像。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run --rm -it demoboth
</span></span></code></pre></div><p>不加cmd执行：执行echo打印了空行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@10 ~<span style=color:#f92672>]</span><span style=color:#75715e># docker run --rm -it demoboth:1.0</span>
</span></span></code></pre></div><p>加cmd传入作为echo的参数打出：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@10 ~<span style=color:#f92672>]</span><span style=color:#75715e># docker run --rm -it demoboth:1.0 echo &#34;hi docker&#34;</span>
</span></span><span style=display:flex><span>echo hi docker
</span></span></code></pre></div><h1 id=shell-格式和-exec-格式>Shell 格式和 Exec 格式</h1><h2 id=shell格式>Shell格式</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>CMD echo <span style=color:#e6db74>&#34;hello docker&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ENTRYPOINT echo <span style=color:#e6db74>&#34;hello docker&#34;</span>
</span></span></code></pre></div><h2 id=exec格式>Exec格式</h2><p>以可执行命令的方式</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ENTRYPOINT <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;echo&#34;</span>, <span style=color:#e6db74>&#34;hello docker&#34;</span><span style=color:#f92672>]</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>CMD <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;echo&#34;</span>, <span style=color:#e6db74>&#34;hello docker&#34;</span><span style=color:#f92672>]</span>
</span></span></code></pre></div><p>注意shell脚本的问题</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>FROM ubuntu:20.04
</span></span><span style=display:flex><span>ENV NAME<span style=color:#f92672>=</span>docker
</span></span><span style=display:flex><span>CMD echo <span style=color:#e6db74>&#34;hello </span>$NAME<span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><p>假如我们要把上面的CMD改成Exec格式，下面这样改是不行的。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>FROM ubuntu:20.04
</span></span><span style=display:flex><span>ENV NAME<span style=color:#f92672>=</span>docker
</span></span><span style=display:flex><span>CMD <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;echo&#34;</span>, <span style=color:#e6db74>&#34;hello </span>$NAME<span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span>
</span></span></code></pre></div><p>它会打印出 <code>hello $NAME</code> , 而不是 <code>hello docker</code> ,那么需要怎么写呢？ 我们需要以shell脚本的方式去执行:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>FROM ubuntu:20.04
</span></span><span style=display:flex><span>ENV NAME<span style=color:#f92672>=</span>docker
</span></span><span style=display:flex><span>CMD <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;sh&#34;</span>, <span style=color:#e6db74>&#34;-c&#34;</span>, <span style=color:#e6db74>&#34;echo hello </span>$NAME<span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span>
</span></span></code></pre></div><p>&ldquo;sh&rdquo;：执行sh命令</p><p>“-c”: 执行的命令</p></div><div class=post-footer></div></article></main></body></html>