<!doctype html><html lang=en-us><head><title>// willxwu</title><link rel="shortcut icon" href=/favicon.ico><meta charset=utf-8><meta name=generator content="Hugo 0.108.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="John Doe"><meta name=description content><link rel=stylesheet href=https://willxwu.github.io/css/main.min.68e582a4d4ed824d6b7e3b5b37cae47eb3779bd631046379d0e68b38230cc3e2.css><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="Collector interface源码分析 源码 public interface Collector<T, A, R> { Supplier<A> supplier(); BiConsumer<A, T> accumulator(); Function<A, R> finisher(); BinaryOperator<A> combiner(); Set<Characteristics> characteristics(); } 说明： 1.T is the generic type of the items in the stream to be collected. 2.A is the type of the accumulator, the object on which the partial result will be accumulated during the collection process. 3.R is the type of the object (typically, but not always, the collection) resulting from the collect operation."><meta property="og:title" content><meta property="og:description" content="Collector interface源码分析 源码 public interface Collector<T, A, R> { Supplier<A> supplier(); BiConsumer<A, T> accumulator(); Function<A, R> finisher(); BinaryOperator<A> combiner(); Set<Characteristics> characteristics(); } 说明： 1.T is the generic type of the items in the stream to be collected. 2.A is the type of the accumulator, the object on which the partial result will be accumulated during the collection process. 3.R is the type of the object (typically, but not always, the collection) resulting from the collect operation."><meta property="og:type" content="article"><meta property="og:url" content="https://willxwu.github.io/posts/java8/collector-interface%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"><meta property="article:section" content="posts"></head><body><header class=app-header><a href=https://willxwu.github.io/><img class=app-header-avatar src=/avatar.jpg alt="John Doe"></a><h1>willxwu</h1><nav class=app-header-menu><a class=app-header-menu-item href=/about/>about</a>
-
<a class=app-header-menu-item href=/>home</a>
-
<a class=app-header-menu-item href=/link/>link</a>
-
<a class=app-header-menu-item href=/tags/>tags</a></nav><p>I write code and I take care about my privacy // Co-founder @ Owaka // Golang lover // Open source enthusiast</p><div class=app-header-social><a target=_blank href=https://github.com/willxwu rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a target=_blank href=https://twitter.com/willxwu rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><title>twitter</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title></h1><div class=post-meta><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Jan 1, 0001</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>1 min read</div></div></header><div class=post-content><h1 id=collector-interface源码分析>Collector interface源码分析</h1><h2 id=源码>源码</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Collector</span><span style=color:#f92672>&lt;</span>T<span style=color:#f92672>,</span> A<span style=color:#f92672>,</span> R<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		Supplier<span style=color:#f92672>&lt;</span>A<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>supplier</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>		BiConsumer<span style=color:#f92672>&lt;</span>A<span style=color:#f92672>,</span> T<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>accumulator</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>		Function<span style=color:#f92672>&lt;</span>A<span style=color:#f92672>,</span> R<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>finisher</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>		BinaryOperator<span style=color:#f92672>&lt;</span>A<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>combiner</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>		Set<span style=color:#f92672>&lt;</span>Characteristics<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>characteristics</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>说明：
1.T is the generic type of the items in the stream to be collected.
2.A is the type of the accumulator, the object on which the partial result will be accumulated during the
collection process.
3.R is the type of the object (typically, but not always, the collection) resulting from the collect
operation.</p><p>T:传入参数类型，A：需要进行处理的方法，R：处理后返回的结果</p><p>特征值：
CONCURRENT：并行的
UNORDERED：无序的
IDENTITY_FINISH：传入什么，返回什么</p><h2 id=范例>范例</h2><h3 id=tolist源码>toList()源码</h3><p><strong>1、入口</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>menu<span style=color:#f92672>.</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>().</span><span style=color:#a6e22e>filter</span><span style=color:#f92672>(</span>t<span style=color:#f92672>-&gt;</span>t<span style=color:#f92672>.</span><span style=color:#a6e22e>isVegetarian</span><span style=color:#f92672>()).</span><span style=color:#a6e22e>collect</span><span style=color:#f92672>(</span>Collectors<span style=color:#f92672>.</span><span style=color:#a6e22e>toList</span><span style=color:#f92672>())</span>
</span></span></code></pre></div><p><strong>2、Collectors.toList()源码：</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    Collector<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>,</span> <span style=color:#f92672>?,</span> List<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;&gt;</span> <span style=color:#a6e22e>toList</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> CollectorImpl<span style=color:#f92672>&lt;&gt;((</span>Supplier<span style=color:#f92672>&lt;</span>List<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;&gt;)</span> ArrayList<span style=color:#f92672>::</span><span style=color:#66d9ef>new</span><span style=color:#f92672>,</span> List<span style=color:#f92672>::</span>add<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                                   <span style=color:#f92672>(</span>left<span style=color:#f92672>,</span> right<span style=color:#f92672>)</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span> left<span style=color:#f92672>.</span><span style=color:#a6e22e>addAll</span><span style=color:#f92672>(</span>right<span style=color:#f92672>);</span> <span style=color:#66d9ef>return</span> left<span style=color:#f92672>;</span> <span style=color:#f92672>},</span>
</span></span><span style=display:flex><span>                                   CH_ID<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><p><strong>3、最后也就是Collector接口</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>        CollectorImpl<span style=color:#f92672>(</span>Supplier<span style=color:#f92672>&lt;</span>A<span style=color:#f92672>&gt;</span> supplier<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                      BiConsumer<span style=color:#f92672>&lt;</span>A<span style=color:#f92672>,</span> T<span style=color:#f92672>&gt;</span> accumulator<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                      BinaryOperator<span style=color:#f92672>&lt;</span>A<span style=color:#f92672>&gt;</span> combiner<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                      Set<span style=color:#f92672>&lt;</span>Characteristics<span style=color:#f92672>&gt;</span> characteristics<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span><span style=color:#f92672>(</span>supplier<span style=color:#f92672>,</span> accumulator<span style=color:#f92672>,</span> combiner<span style=color:#f92672>,</span> castingIdentity<span style=color:#f92672>(),</span> characteristics<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=流程图>流程图</h2><p>1、Collector执行流程图
<img src=https://cdn.jsdelivr.net/gh/willxwu/CDN@main/images/202209192048749.jpg alt=Collector></p><p>执行过程:
1、通过Supplier supplier创建一个Container容器。
2、查看stream里面是否还有元素。
3、如果有，通过带2个入参一个返回结果参数的BiConsumer&lt;A, T> accumulator进行数据处理。
4、处理完后通过finisher返回执行结果。</p><p>collect源码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>final</span> <span style=color:#f92672>&lt;</span>R<span style=color:#f92672>,</span> A<span style=color:#f92672>&gt;</span> R <span style=color:#a6e22e>collect</span><span style=color:#f92672>(</span>Collector<span style=color:#f92672>&lt;?</span> <span style=color:#66d9ef>super</span> P_OUT<span style=color:#f92672>,</span> A<span style=color:#f92672>,</span> R<span style=color:#f92672>&gt;</span> collector<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        A container<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>isParallel<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>(</span>collector<span style=color:#f92672>.</span><span style=color:#a6e22e>characteristics</span><span style=color:#f92672>().</span><span style=color:#a6e22e>contains</span><span style=color:#f92672>(</span>Collector<span style=color:#f92672>.</span><span style=color:#a6e22e>Characteristics</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CONCURRENT</span><span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>(!</span>isOrdered<span style=color:#f92672>()</span> <span style=color:#f92672>||</span> collector<span style=color:#f92672>.</span><span style=color:#a6e22e>characteristics</span><span style=color:#f92672>().</span><span style=color:#a6e22e>contains</span><span style=color:#f92672>(</span>Collector<span style=color:#f92672>.</span><span style=color:#a6e22e>Characteristics</span><span style=color:#f92672>.</span><span style=color:#a6e22e>UNORDERED</span><span style=color:#f92672>)))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//获取容器
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            container <span style=color:#f92672>=</span> collector<span style=color:#f92672>.</span><span style=color:#a6e22e>supplier</span><span style=color:#f92672>().</span><span style=color:#a6e22e>get</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            BiConsumer<span style=color:#f92672>&lt;</span>A<span style=color:#f92672>,</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>super</span> P_OUT<span style=color:#f92672>&gt;</span> accumulator <span style=color:#f92672>=</span> collector<span style=color:#f92672>.</span><span style=color:#a6e22e>accumulator</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>//通过accumulator进行处理
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            forEach<span style=color:#f92672>(</span>u <span style=color:#f92672>-&gt;</span> accumulator<span style=color:#f92672>.</span><span style=color:#a6e22e>accept</span><span style=color:#f92672>(</span>container<span style=color:#f92672>,</span> u<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            container <span style=color:#f92672>=</span> evaluate<span style=color:#f92672>(</span>ReduceOps<span style=color:#f92672>.</span><span style=color:#a6e22e>makeRef</span><span style=color:#f92672>(</span>collector<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>//执行完，返回执行结果
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> collector<span style=color:#f92672>.</span><span style=color:#a6e22e>characteristics</span><span style=color:#f92672>().</span><span style=color:#a6e22e>contains</span><span style=color:#f92672>(</span>Collector<span style=color:#f92672>.</span><span style=color:#a6e22e>Characteristics</span><span style=color:#f92672>.</span><span style=color:#a6e22e>IDENTITY_FINISH</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>               <span style=color:#f92672>?</span> <span style=color:#f92672>(</span>R<span style=color:#f92672>)</span> container
</span></span><span style=display:flex><span>               <span style=color:#f92672>:</span> collector<span style=color:#f92672>.</span><span style=color:#a6e22e>finisher</span><span style=color:#f92672>().</span><span style=color:#a6e22e>apply</span><span style=color:#f92672>(</span>container<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    
</span></span></code></pre></div><p>2、combiner并行执行执行流程图
<img src=https://cdn.jsdelivr.net/gh/willxwu/CDN@main/images/202209192049565.jpg alt=combiner></p><p>产生多个supplier并行处理，然后将多个处理结果combiner成一个，然后将结果返回。</p></div><div class=post-footer></div></article></main></body></html>