<!doctype html><html lang=en><head><title>// willxwu</title><link rel="shortcut icon" href=/favicon.ico><meta charset=utf-8><meta name=generator content="Hugo 0.115.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="willxwu"><meta name=description content><link rel=stylesheet href=https://willxwu.github.io/css/main.min.68e582a4d4ed824d6b7e3b5b37cae47eb3779bd631046379d0e68b38230cc3e2.css><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="Stream parallel 并行执行 范例：求1~100000000的和，执行10次，看时间效率。 代码 package com.example.study.java8.collector; import java.util.function.Function; import java.util.stream.LongStream; import java.util.stream.Stream; /** * Stream parallel并行执行 * 实列：求10次，1~100000000的和，看时间效率。 */ public class ParallelProcessing { public static void main(String[] args) { //获取电脑CPU核数 System.out.println(&#34;当前电脑CPU核数= &#34; + Runtime.getRuntime().availableProcessors()); System.out.println(&#34;The best process time(normalAdd)=> &#34; + measureSumPerformance(ParallelProcessing::normalAdd, 100_000_000) + &#34; MS&#34;); System.out.println(&#34;The best process time(iterateStream1)=> &#34; + measureSumPerformance(ParallelProcessing::iterateStream1, 100_000_000) + &#34; MS&#34;); System.out.println(&#34;The best process time(iterateStream2)=> &#34; + measureSumPerformance(ParallelProcessing::iterateStream2, 100_000_000) + &#34; MS&#34;); System.out.println(&#34;The best process time(iterateStream3)=> &#34; + measureSumPerformance(ParallelProcessing::iterateStream3, 100_000_000) + &#34; MS&#34;); System."><meta property="og:title" content><meta property="og:description" content="Stream parallel 并行执行 范例：求1~100000000的和，执行10次，看时间效率。 代码 package com.example.study.java8.collector; import java.util.function.Function; import java.util.stream.LongStream; import java.util.stream.Stream; /** * Stream parallel并行执行 * 实列：求10次，1~100000000的和，看时间效率。 */ public class ParallelProcessing { public static void main(String[] args) { //获取电脑CPU核数 System.out.println(&#34;当前电脑CPU核数= &#34; + Runtime.getRuntime().availableProcessors()); System.out.println(&#34;The best process time(normalAdd)=> &#34; + measureSumPerformance(ParallelProcessing::normalAdd, 100_000_000) + &#34; MS&#34;); System.out.println(&#34;The best process time(iterateStream1)=> &#34; + measureSumPerformance(ParallelProcessing::iterateStream1, 100_000_000) + &#34; MS&#34;); System.out.println(&#34;The best process time(iterateStream2)=> &#34; + measureSumPerformance(ParallelProcessing::iterateStream2, 100_000_000) + &#34; MS&#34;); System.out.println(&#34;The best process time(iterateStream3)=> &#34; + measureSumPerformance(ParallelProcessing::iterateStream3, 100_000_000) + &#34; MS&#34;); System."><meta property="og:type" content="article"><meta property="og:url" content="https://willxwu.github.io/posts/java8/java8-stream-parallel-%E5%B9%B6%E8%A1%8C%E6%89%A7%E8%A1%8C/"><meta property="article:section" content="posts"></head><body><header class=app-header><a href=https://willxwu.github.io/><img class=app-header-avatar src=/avatar.jpg alt=willxwu></a><h1>willxwu</h1><p>生活哪有那么复杂，简单甚好。@万般滋味，皆是生活。</p><div class=app-header-social><a target=_blank href=https://github.com/willxwu rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a target=_blank href=https://twitter.com/i2school rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><title>twitter</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a target=_blank href=https://twitter.com/willxwu rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-umbrella"><title>umbrella</title><path d="M23 12A11.05 11.05.0 001 12zm-5 7a3 3 0 01-6 0v-7"/></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title></h1><div class=post-meta><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Jan 1, 0001</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>2 min read</div></div></header><div class=post-content><h1 id=stream-parallel-并行执行>Stream parallel 并行执行</h1><h2 id=范例求1100000000的和执行10次看时间效率>范例：求1~100000000的和，执行10次，看时间效率。</h2><h2 id=代码>代码</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.example.study.java8.collector<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.function.Function<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.stream.LongStream<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.stream.Stream<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Stream parallel并行执行
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 实列：求10次，1~100000000的和，看时间效率。
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ParallelProcessing</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//获取电脑CPU核数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;当前电脑CPU核数= &#34;</span> <span style=color:#f92672>+</span> Runtime<span style=color:#f92672>.</span><span style=color:#a6e22e>getRuntime</span><span style=color:#f92672>().</span><span style=color:#a6e22e>availableProcessors</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;The best process time(normalAdd)=&gt; &#34;</span> <span style=color:#f92672>+</span> measureSumPerformance<span style=color:#f92672>(</span>ParallelProcessing<span style=color:#f92672>::</span>normalAdd<span style=color:#f92672>,</span> <span style=color:#ae81ff>100_000_000</span><span style=color:#f92672>)</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; MS&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;The best process time(iterateStream1)=&gt; &#34;</span> <span style=color:#f92672>+</span> measureSumPerformance<span style=color:#f92672>(</span>ParallelProcessing<span style=color:#f92672>::</span>iterateStream1<span style=color:#f92672>,</span> <span style=color:#ae81ff>100_000_000</span><span style=color:#f92672>)</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; MS&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;The best process time(iterateStream2)=&gt; &#34;</span> <span style=color:#f92672>+</span> measureSumPerformance<span style=color:#f92672>(</span>ParallelProcessing<span style=color:#f92672>::</span>iterateStream2<span style=color:#f92672>,</span> <span style=color:#ae81ff>100_000_000</span><span style=color:#f92672>)</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; MS&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;The best process time(iterateStream3)=&gt; &#34;</span> <span style=color:#f92672>+</span> measureSumPerformance<span style=color:#f92672>(</span>ParallelProcessing<span style=color:#f92672>::</span>iterateStream3<span style=color:#f92672>,</span> <span style=color:#ae81ff>100_000_000</span><span style=color:#f92672>)</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; MS&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;The best process time(iterateStream4)=&gt; &#34;</span> <span style=color:#f92672>+</span> measureSumPerformance<span style=color:#f92672>(</span>ParallelProcessing<span style=color:#f92672>::</span>iterateStream4<span style=color:#f92672>,</span> <span style=color:#ae81ff>100_000_000</span><span style=color:#f92672>)</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; MS&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;The best process time(iterateStream5)=&gt; &#34;</span> <span style=color:#f92672>+</span> measureSumPerformance<span style=color:#f92672>(</span>ParallelProcessing<span style=color:#f92672>::</span>iterateStream5<span style=color:#f92672>,</span> <span style=color:#ae81ff>100_000_000</span><span style=color:#f92672>)</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; MS&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>long</span> <span style=color:#a6e22e>measureSumPerformance</span><span style=color:#f92672>(</span>Function<span style=color:#f92672>&lt;</span>Long<span style=color:#f92672>,</span> Long<span style=color:#f92672>&gt;</span> adder<span style=color:#f92672>,</span> <span style=color:#66d9ef>long</span> limist<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>long</span> fastest <span style=color:#f92672>=</span> Long<span style=color:#f92672>.</span><span style=color:#a6e22e>MAX_VALUE</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>10</span><span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            Long startTimestamp <span style=color:#f92672>=</span> System<span style=color:#f92672>.</span><span style=color:#a6e22e>currentTimeMillis</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>long</span> result <span style=color:#f92672>=</span> adder<span style=color:#f92672>.</span><span style=color:#a6e22e>apply</span><span style=color:#f92672>(</span>limist<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>long</span> duration <span style=color:#f92672>=</span> System<span style=color:#f92672>.</span><span style=color:#a6e22e>currentTimeMillis</span><span style=color:#f92672>()</span> <span style=color:#f92672>-</span> startTimestamp<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//            System.out.println(&#34;The result of sum=&gt;&#34;+result);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>duration <span style=color:#f92672>&lt;</span> fastest<span style=color:#f92672>)</span> fastest <span style=color:#f92672>=</span> duration<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> fastest<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 1、函数式编程实现：没有使用并行执行
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param limit
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>long</span> <span style=color:#a6e22e>iterateStream1</span><span style=color:#f92672>(</span><span style=color:#66d9ef>long</span> limit<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Stream<span style=color:#f92672>.</span><span style=color:#a6e22e>iterate</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1L</span><span style=color:#f92672>,</span> i <span style=color:#f92672>-&gt;</span> i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>).</span><span style=color:#a6e22e>limit</span><span style=color:#f92672>(</span>limit<span style=color:#f92672>).</span><span style=color:#a6e22e>reduce</span><span style=color:#f92672>(</span><span style=color:#ae81ff>0</span>L<span style=color:#f92672>,</span> Long<span style=color:#f92672>::</span>sum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 2、函数式编程实现-进化：使用并行执行，要进行拆箱装箱
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param limit
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>long</span> <span style=color:#a6e22e>iterateStream2</span><span style=color:#f92672>(</span><span style=color:#66d9ef>long</span> limit<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Stream<span style=color:#f92672>.</span><span style=color:#a6e22e>iterate</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1L</span><span style=color:#f92672>,</span> i <span style=color:#f92672>-&gt;</span> i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>).</span><span style=color:#a6e22e>parallel</span><span style=color:#f92672>().</span><span style=color:#a6e22e>limit</span><span style=color:#f92672>(</span>limit<span style=color:#f92672>).</span><span style=color:#a6e22e>reduce</span><span style=color:#f92672>(</span><span style=color:#ae81ff>0</span>L<span style=color:#f92672>,</span> Long<span style=color:#f92672>::</span>sum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 3、函数式编程实现-再次进化：只用并行执行，不进行拆箱装箱
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param limit
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>long</span> <span style=color:#a6e22e>iterateStream3</span><span style=color:#f92672>(</span><span style=color:#66d9ef>long</span> limit<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Stream<span style=color:#f92672>.</span><span style=color:#a6e22e>iterate</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1L</span><span style=color:#f92672>,</span> i <span style=color:#f92672>-&gt;</span> i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>).</span><span style=color:#a6e22e>mapToLong</span><span style=color:#f92672>(</span>Long<span style=color:#f92672>::</span>longValue<span style=color:#f92672>).</span><span style=color:#a6e22e>parallel</span><span style=color:#f92672>().</span><span style=color:#a6e22e>limit</span><span style=color:#f92672>(</span>limit<span style=color:#f92672>).</span><span style=color:#a6e22e>reduce</span><span style=color:#f92672>(</span><span style=color:#ae81ff>0</span>L<span style=color:#f92672>,</span> Long<span style=color:#f92672>::</span>sum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 4、函数式编程实现-再次再次进化：只用并行执行
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param limit
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>long</span> <span style=color:#a6e22e>iterateStream4</span><span style=color:#f92672>(</span><span style=color:#66d9ef>long</span> limit<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> LongStream<span style=color:#f92672>.</span><span style=color:#a6e22e>rangeClosed</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1L</span><span style=color:#f92672>,</span> limit<span style=color:#f92672>).</span><span style=color:#a6e22e>parallel</span><span style=color:#f92672>().</span><span style=color:#a6e22e>sum</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 5、函数式编程实现-再次再次再次进化
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param limit
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>long</span> <span style=color:#a6e22e>iterateStream5</span><span style=color:#f92672>(</span><span style=color:#66d9ef>long</span> limit<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> LongStream<span style=color:#f92672>.</span><span style=color:#a6e22e>rangeClosed</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1L</span><span style=color:#f92672>,</span> limit<span style=color:#f92672>).</span><span style=color:#a6e22e>parallel</span><span style=color:#f92672>().</span><span style=color:#a6e22e>reduce</span><span style=color:#f92672>(</span><span style=color:#ae81ff>0</span>L<span style=color:#f92672>,</span> Long<span style=color:#f92672>::</span>sum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 原始写法
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param limit
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>long</span> <span style=color:#a6e22e>normalAdd</span><span style=color:#f92672>(</span><span style=color:#66d9ef>long</span> limit<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>long</span> result <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>L<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>long</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span> limit<span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            result<span style=color:#f92672>++;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> result<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=输出结果>输出结果</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>当前电脑</span>CPU<span style=color:#960050;background-color:#1e0010>核数</span><span style=color:#f92672>=</span> <span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>The best process <span style=color:#a6e22e>time</span><span style=color:#f92672>(</span>normalAdd<span style=color:#f92672>)=&gt;</span> <span style=color:#ae81ff>29</span> MS
</span></span><span style=display:flex><span>The best process <span style=color:#a6e22e>time</span><span style=color:#f92672>(</span>iterateStream1<span style=color:#f92672>)=&gt;</span> <span style=color:#ae81ff>794</span> MS
</span></span><span style=display:flex><span>The best process <span style=color:#a6e22e>time</span><span style=color:#f92672>(</span>iterateStream2<span style=color:#f92672>)=&gt;</span> <span style=color:#ae81ff>2718</span> MS
</span></span><span style=display:flex><span>The best process <span style=color:#a6e22e>time</span><span style=color:#f92672>(</span>iterateStream3<span style=color:#f92672>)=&gt;</span> <span style=color:#ae81ff>2132</span> MS
</span></span><span style=display:flex><span>The best process <span style=color:#a6e22e>time</span><span style=color:#f92672>(</span>iterateStream4<span style=color:#f92672>)=&gt;</span> <span style=color:#ae81ff>6</span> MS
</span></span><span style=display:flex><span>The best process <span style=color:#a6e22e>time</span><span style=color:#f92672>(</span>iterateStream5<span style=color:#f92672>)=&gt;</span> <span style=color:#ae81ff>24</span> MS
</span></span></code></pre></div><h2 id=4和5效率差不多>4和5效率差不多</h2><p>输出结果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>当前电脑</span>CPU<span style=color:#960050;background-color:#1e0010>核数</span><span style=color:#f92672>=</span> <span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>The best process <span style=color:#a6e22e>time</span><span style=color:#f92672>(</span>normalAdd<span style=color:#f92672>)=&gt;</span> <span style=color:#ae81ff>29</span> MS
</span></span><span style=display:flex><span>The best process <span style=color:#a6e22e>time</span><span style=color:#f92672>(</span>iterateStream4<span style=color:#f92672>)=&gt;</span> <span style=color:#ae81ff>4</span> MS
</span></span><span style=display:flex><span>The best process <span style=color:#a6e22e>time</span><span style=color:#f92672>(</span>iterateStream5<span style=color:#f92672>)=&gt;</span> <span style=color:#ae81ff>5</span> MS
</span></span></code></pre></div><h2 id=结果>结果</h2><p>可以看到使用LongStream的parallel并发执行效率最高。</p><hr><h1 id=使用注意点>使用注意点</h1><p>Source Decomposability</p><p>ArrayList Excellent( 极好的)
LinkedList Poor(不好的)
IntStream.range Excellent( 极好的)
Stream.iterate Poor(不好的)
HashSet Good(好的)
TreeSet Good(好的)</p><p>上面的例子就是使用的LongStream.rangeClosed（），就是IntStream.range效率Excellent( 极好的)。</p></div><div class=post-footer></div></article></main></body></html>