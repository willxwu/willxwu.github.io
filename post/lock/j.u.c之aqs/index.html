<!doctype html><html lang=en><head><meta charset=utf-8><title>Java J.U.C之AQS</title><link href=//cdn.jsdelivr.net rel=dns-prefetch><link href=//cdnjs.cloudflare.com rel=dns-prefetch><link href=//at.alicdn.com rel=dns-prefetch><link href=//fonts.googleapis.com rel=dns-prefetch><link href=//fonts.gstatic.com rel=dns-prefetch><link href=///disqus.com rel=dns-prefetch><link href=//c.disquscdn.com rel=dns-prefetch><link href=//www.google-analytics.com rel=dns-prefetch><meta name=description content="AQS J.U.C之AQS，底层由线程队列实现。AbstractQueuedSynchronizer简称AQS，JUC的核心。
使用Node实现FIFO队列，可以用于构建锁或者其他同步装置的基础框架。 利用了一个int类型表示状态。 使用方法是继承。 子类通过继承并通过实现它的方法管理其状态{acquire和release}的方法操纵状态。 可以同时实现排它锁和共享锁模式（独占、共享）。
"><meta name=twitter:card content="summary"><meta name=twitter:site content="@twitter_username"><meta name=twitter:title content="Java J.U.C之AQS"><meta name=twitter:description content="AQS J.U.C之AQS，底层由线程队列实现。AbstractQueuedSynchronizer简称AQS，JUC的核心。
使用Node实现FIFO队列，可以用于构建锁或者其他同步装置的基础框架。 利用了一个int类型表示状态。 使用方法是继承。 子类通过继承并通过实现它的方法管理其状态{acquire和release}的方法操纵状态。 可以同时实现排它锁和共享锁模式（独占、共享）。
"><meta name=twitter:image content="/images/avatar.png"><meta property="og:type" content="article"><meta property="og:title" content="Java J.U.C之AQS"><meta property="og:description" content="AQS J.U.C之AQS，底层由线程队列实现。AbstractQueuedSynchronizer简称AQS，JUC的核心。
使用Node实现FIFO队列，可以用于构建锁或者其他同步装置的基础框架。 利用了一个int类型表示状态。 使用方法是继承。 子类通过继承并通过实现它的方法管理其状态{acquire和release}的方法操纵状态。 可以同时实现排它锁和共享锁模式（独占、共享）。
"><meta property="og:url" content="https://willxwu.github.io/post/lock/j.u.c%E4%B9%8Baqs/"><meta property="og:image" content="/images/avatar.png"><link rel=canonical href=https://willxwu.github.io/post/lock/j.u.c%E4%B9%8Baqs/><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=format-detection content="telephone=no,email=no,adress=no"><meta http-equiv=cache-control content="no-transform"><meta name=robots content="index,follow"><meta name=referrer content="origin-when-cross-origin"><meta name=theme-color content="#02b875"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta name=apple-mobile-web-app-title content="Come Back"><meta name=msapplication-tooltip content="Come Back"><meta name=msapplication-navbutton-color content="#02b875"><meta name=msapplication-TileColor content="#02b875"><meta name=msapplication-TileImage content="/icons/icon-144x144.png"><link rel=icon href=https://willxwu.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://willxwu.github.io/icons/icon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://willxwu.github.io/icons/icon-32x32.png><link rel=icon sizes=192x192 href=https://willxwu.github.io/icons/icon-192x192.png><link rel=apple-touch-icon href=https://willxwu.github.io/icons/icon-152x152.png><link rel=manifest href=https://willxwu.github.io/manifest.json><link rel=preload href=https://willxwu.github.io/styles/main-rendered.min.css as=style><link rel=preload href="https://fonts.googleapis.com/css?family=Lobster" as=style><link rel=preload href=https://willxwu.github.io/images/avatar.png as=image><link rel=preload href=https://willxwu.github.io/images/grey-prism.svg as=image><style>body{background:#f4f3f1 url(/images/grey-prism.svg)repeat fixed}</style><link rel=stylesheet href=https://willxwu.github.io/styles/main-rendered.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lobster"><script src=https://cdn.jsdelivr.net/npm/medium-zoom@1.0.2/dist/medium-zoom.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/video.js@7.3.0/dist/video-js.min.css><!--[if lte IE 8]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/videojs-ie8@1.1.2/dist/videojs-ie8.min.js></script><![endif]--><!--[if lte IE 9]><script src=https://cdn.jsdelivr.net/npm/eligrey-classlist-js-polyfill@1.2.20180112/classList.min.js></script><![endif]--></head><body><div class=suspension><a role=button aria-label="Go to top" title="Go to top" class="to-top is-hide"><span class="icon icon-up" aria-hidden=true></span></a>
<a role=button aria-label="Go to comments" title="Go to comments" class=to-comment href=#disqus_thread><span class="icon icon-comment" aria-hidden=true></span></a></div><header class=site-header><a href=https://willxwu.github.io><img class=avatar src=https://willxwu.github.io/images/avatar.png alt=Avatar></a><h2 class=title><a href=https://willxwu.github.io>Come Back</a></h2><p class=subtitle>All kinds of taste, are life.</p><button class=menu-toggle type=button aria-label="Main Menu" aria-expanded=false tab-index=0>
<span class="icon icon-menu" aria-hidden=true></span></button><nav class="site-menu collapsed"><h2 class=offscreen>Main Menu</h2><ul class=menu-list><li class="menu-item
is-active"><a href=https://willxwu.github.io/>Home</a></li><li class=menu-item><a href=https://willxwu.github.io/archives/>archives</a></li><li class=menu-item><a href=https://willxwu.github.io/tags/>Tags</a></li><li class=menu-item><a href=https://willxwu.github.io/links/>Links</a></li><li class=menu-item><a href=https://willxwu.github.io/resume/>resume</a></li><li class=menu-item><a href=https://willxwu.github.io/about/>About</a></li></ul></nav><nav class="social-menu collapsed"><h2 class=offscreen>Social Networks</h2><ul class=social-list><li class=social-item><a href=mailto:name@domain.com title=Email aria-label=Email><span class="icon icon-email" aria-hidden=true></span></a></li><li class=social-item><a href=//github.com/github_username rel=me title=GitHub aria-label=GitHub><span class="icon icon-github" aria-hidden=true></span></a></li><li class=social-item><a href=//twitter.com/twitter_username rel=me title=Twitter aria-label=Twitter><span class="icon icon-twitter" aria-hidden=true></span></a></li><li class=social-item><a href=//weibo.com/weibo_username rel=me title=Weibo aria-label=Weibo><span class="icon icon-weibo" aria-hidden=true></span></a></li><li class=social-item><a href=https://willxwu.github.io/images/qrcode.jpg rel=me title=Wechat aria-label=Wechat><span class="icon icon-wechat" aria-hidden=true></span></a></li><li class=social-item><a href=//www.linkedin.com/in/linkedin_username rel=me title=LinkedIn aria-label=LinkedIn><span class="icon icon-linkedin" aria-hidden=true></span></a></li></ul></nav></header><section class="main post-detail"><header class=post-header><h1 class=post-title>Java J.U.C之AQS</h1><p class=post-meta>@Come Back · Mar 24, 2022 · 11 min read</p></header><article class=post-content><h1 id=aqs>AQS</h1><p>J.U.C之AQS，底层由线程队列实现。AbstractQueuedSynchronizer简称AQS，JUC的核心。</p><p><img src=https://cdn.jsdelivr.net/gh/willxwu/CDN@main/images/202204252000380.png alt></p><p>使用Node实现FIFO队列，可以用于构建锁或者其他同步装置的基础框架。
利用了一个int类型表示状态。
使用方法是继承。
子类通过继承并通过实现它的方法管理其状态{acquire和release}的方法操纵状态。
可以同时实现排它锁和共享锁模式（独占、共享）。</p><h1 id=aqs主要同步组件>AQS主要同步组件</h1><ol><li><p>CountDownLatch</p></li><li><p>Semaphore</p></li><li><p>CyclicBarrier</p></li><li><p>ReentrantLock</p></li><li><p>Condition</p></li><li><p>FutureTask</p></li></ol><h1 id=依次介绍>依次介绍</h1><h1 id=1countdownlatch-闭锁>1、CountDownLatch-闭锁</h1><p><img src=https://cdn.jsdelivr.net/gh/willxwu/CDN@main/images/202204252013410.png alt></p><p>可以完成类似阻塞的功能。一个线程或多个线程等待，直到其它线程完成。使用场景，程序执行需要某个条件执行完后，才执行。</p><h2 id=示例一>示例一</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.yanxizhu.demo.concurrency.aqs<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.yanxizhu.demo.concurrency.annotation.ThreadSafety<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> lombok.extern.slf4j.Slf4j<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.CountDownLatch<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.ExecutorService<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.Executors<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @description: CountDownLatch,实现线程阻塞，等待执行完再执行程序打印
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author: &lt;a href=&#34;mailto:batis@foxmail.com&#34;&gt;清风&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @date: 2022/4/25 20:24
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @version: 1.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@ThreadSafety</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> threadNum <span style=color:#f92672>=</span> 500<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        ExecutorService executorService <span style=color:#f92672>=</span> Executors<span style=color:#f92672>.</span><span style=color:#a6e22e>newCachedThreadPool</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        CountDownLatch countDownLatch <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CountDownLatch<span style=color:#f92672>(</span>threadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span>threadNum<span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> num <span style=color:#f92672>=</span> i<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    pringNum<span style=color:#f92672>(</span>num<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span><span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                    log<span style=color:#f92672>.</span><span style=color:#a6e22e>error</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;执行错误【{}】&#34;</span><span style=color:#f92672>,</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span><span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    countDownLatch<span style=color:#f92672>.</span><span style=color:#a6e22e>countDown</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        countDownLatch<span style=color:#f92672>.</span><span style=color:#a6e22e>await</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>shutdown</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;finash ..&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>pringNum</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> num<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span>100<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;num=【{}】&#34;</span><span style=color:#f92672>,</span> num<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span>100<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>输出结果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>。。。。。</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>598</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>249<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>248<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>608</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>259<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>258<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>597</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>237<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>236<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>597</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>206<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>205<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>608</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>256<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>255<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>608</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>258<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>257<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>597</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>240<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>239<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>597</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>67<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>66<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>608</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>251<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>250<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>608</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>257<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>256<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>608</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>44<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>43<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>598</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>61<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>60<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>598</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>33<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>32<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>597</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>172<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>171<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>608</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>230<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>229<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>608</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>253<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>252<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>598</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>59<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>58<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>598</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>39<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>38<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>608</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>298<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>297<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>596</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>192<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>191<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>597</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>75<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>74<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>608</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>299<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>298<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>597</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>146<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>145<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>608</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>304<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>303<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>598</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>229<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>228<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>597</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>87<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>86<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>597</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>46<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>45<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:36<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>764</span> <span style=color:#f92672>[</span>main<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo</span> <span style=color:#f92672>-</span> finash <span style=color:#f92672>..</span>
</span></span></code></pre></div><p>另一种用法，给定时间内未执行执行await方法。到时间等当前线程执行完成后就不执行了。</p><h2 id=示例一-1>示例一</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.yanxizhu.demo.concurrency.aqs<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.yanxizhu.demo.concurrency.annotation.ThreadSafety<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> lombok.extern.slf4j.Slf4j<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.CountDownLatch<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.ExecutorService<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.Executors<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.TimeUnit<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @description: CountDownLatch,设置等待时间
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author: &lt;a href=&#34;mailto:batis@foxmail.com&#34;&gt;清风&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @date: 2022/4/25 20:24
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @version: 1.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@ThreadSafety</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CountDownLatchDemo2</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> threadNum <span style=color:#f92672>=</span> 500<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        ExecutorService executorService <span style=color:#f92672>=</span> Executors<span style=color:#f92672>.</span><span style=color:#a6e22e>newCachedThreadPool</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        CountDownLatch countDownLatch <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CountDownLatch<span style=color:#f92672>(</span>threadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span>threadNum<span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> num <span style=color:#f92672>=</span> i<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    pringNum<span style=color:#f92672>(</span>num<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span><span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                    log<span style=color:#f92672>.</span><span style=color:#a6e22e>error</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;执行错误【{}】&#34;</span><span style=color:#f92672>,</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span><span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    countDownLatch<span style=color:#f92672>.</span><span style=color:#a6e22e>countDown</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>//设置了等待时间
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        countDownLatch<span style=color:#f92672>.</span><span style=color:#a6e22e>await</span><span style=color:#f92672>(</span>100<span style=color:#f92672>,</span> TimeUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>MILLISECONDS</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>shutdown</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;finash ..&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>pringNum</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> num<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span>100<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;num=【{}】&#34;</span><span style=color:#f92672>,</span> num<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>输出结果</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>20:39<span style=color:#f92672>:</span>27<span style=color:#f92672>.</span><span style=color:#a6e22e>285</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>258<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>257<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:39<span style=color:#f92672>:</span>27<span style=color:#f92672>.</span><span style=color:#a6e22e>284</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>180<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>179<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:39<span style=color:#f92672>:</span>27<span style=color:#f92672>.</span><span style=color:#a6e22e>287</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>54<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>53<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:39<span style=color:#f92672>:</span>27<span style=color:#f92672>.</span><span style=color:#a6e22e>283</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>368<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>367<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:39<span style=color:#f92672>:</span>27<span style=color:#f92672>.</span><span style=color:#a6e22e>285</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>8<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>7<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:39<span style=color:#f92672>:</span>27<span style=color:#f92672>.</span><span style=color:#a6e22e>301</span> <span style=color:#f92672>[</span>main<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo2</span> <span style=color:#f92672>-</span> finash <span style=color:#f92672>..</span>
</span></span><span style=display:flex><span>20:39<span style=color:#f92672>:</span>27<span style=color:#f92672>.</span><span style=color:#a6e22e>286</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>204<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>203<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:39<span style=color:#f92672>:</span>27<span style=color:#f92672>.</span><span style=color:#a6e22e>301</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>42<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>41<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:39<span style=color:#f92672>:</span>27<span style=color:#f92672>.</span><span style=color:#a6e22e>305</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>432<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>431<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:39<span style=color:#f92672>:</span>27<span style=color:#f92672>.</span><span style=color:#a6e22e>285</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>270<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CountDownLatchDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>269<span style=color:#960050;background-color:#1e0010>】</span>
</span></span></code></pre></div><p>100毫秒后执行打印finash，之后的线程执行完后不再执行。</p><h1 id=2semaphore-信号量>2、Semaphore-信号量</h1><p>用于控制线程并发的个数。使用场景，提供仅限使用的资源。比如：有大量请求时，可用信号量控制数据库连接数，防止大量请求。</p><p><img src=https://cdn.jsdelivr.net/gh/willxwu/CDN@main/images/202204252042691.png alt></p><h2 id=示例一-2>示例一</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.yanxizhu.demo.concurrency.aqs<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.yanxizhu.demo.concurrency.annotation.ThreadSafety<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> lombok.extern.slf4j.Slf4j<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.*<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @description: Semaphore-信号量，控制线程并发数
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author: &lt;a href=&#34;mailto:batis@foxmail.com&#34;&gt;清风&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @date: 2022/4/25 20:41
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @version: 1.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@ThreadSafety</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> threadNum <span style=color:#f92672>=</span> 20<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> currentThreadNum <span style=color:#f92672>=</span> 3<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//线程池
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        ExecutorService executorService <span style=color:#f92672>=</span> Executors<span style=color:#f92672>.</span><span style=color:#a6e22e>newCachedThreadPool</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//信号量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        Semaphore semaphore <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Semaphore<span style=color:#f92672>(</span>currentThreadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span>threadNum<span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> num <span style=color:#f92672>=</span> i<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>//获取一个许可
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    semaphore<span style=color:#f92672>.</span><span style=color:#a6e22e>acquire</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                    pringNum<span style=color:#f92672>(</span>num<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>//释放一个许可
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    semaphore<span style=color:#f92672>.</span><span style=color:#a6e22e>release</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span><span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                    log<span style=color:#f92672>.</span><span style=color:#a6e22e>error</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;执行错误【{}】&#34;</span><span style=color:#f92672>,</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>shutdown</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>pringNum</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> num<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;num=【{}】&#34;</span><span style=color:#f92672>,</span> num<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span>1000<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>输出结果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#e6db74>&#34;C:\Program Files\jdk-11.0.10_windows-x64_bin\jdk-11.0.10\bin\java.exe&#34;</span> <span style=color:#f92672>-</span>Dvisualvm<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>=</span>83604261825100 <span style=color:#e6db74>&#34;-javaagent:C:\Program Files\JetBrains\IntelliJ IDEA 2020.3.2\lib\idea_rt.jar=11416:C:\Program Files\JetBrains\IntelliJ IDEA 2020.3.2\bin&#34;</span> <span style=color:#f92672>-</span>Dfile<span style=color:#f92672>.</span><span style=color:#a6e22e>encoding</span><span style=color:#f92672>=</span>UTF<span style=color:#f92672>-</span>8 <span style=color:#f92672>-</span>classpath D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Workspaces<span style=color:#960050;background-color:#1e0010>\</span>ThreadConcurrency<span style=color:#960050;background-color:#1e0010>\</span>demo<span style=color:#f92672>-</span>concurrency<span style=color:#960050;background-color:#1e0010>\</span>target<span style=color:#960050;background-color:#1e0010>\</span>classes<span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>boot<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>starter<span style=color:#f92672>-</span>web<span style=color:#960050;background-color:#1e0010>\</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>starter<span style=color:#f92672>-</span>web<span style=color:#f92672>-</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>boot<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>starter<span style=color:#960050;background-color:#1e0010>\</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>starter<span style=color:#f92672>-</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>boot<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>starter<span style=color:#f92672>-</span>logging<span style=color:#960050;background-color:#1e0010>\</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>starter<span style=color:#f92672>-</span>logging<span style=color:#f92672>-</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>ch<span style=color:#960050;background-color:#1e0010>\</span>qos<span style=color:#960050;background-color:#1e0010>\</span>logback<span style=color:#960050;background-color:#1e0010>\</span>logback<span style=color:#f92672>-</span>classic<span style=color:#960050;background-color:#1e0010>\</span>1<span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>11</span><span style=color:#960050;background-color:#1e0010>\</span>logback<span style=color:#f92672>-</span>classic<span style=color:#f92672>-</span>1<span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>11</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>ch<span style=color:#960050;background-color:#1e0010>\</span>qos<span style=color:#960050;background-color:#1e0010>\</span>logback<span style=color:#960050;background-color:#1e0010>\</span>logback<span style=color:#f92672>-</span>core<span style=color:#960050;background-color:#1e0010>\</span>1<span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>11</span><span style=color:#960050;background-color:#1e0010>\</span>logback<span style=color:#f92672>-</span>core<span style=color:#f92672>-</span>1<span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>11</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>apache<span style=color:#960050;background-color:#1e0010>\</span>logging<span style=color:#960050;background-color:#1e0010>\</span>log4j<span style=color:#960050;background-color:#1e0010>\</span>log4j<span style=color:#f92672>-</span>to<span style=color:#f92672>-</span>slf4j<span style=color:#960050;background-color:#1e0010>\</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>17</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#960050;background-color:#1e0010>\</span>log4j<span style=color:#f92672>-</span>to<span style=color:#f92672>-</span>slf4j<span style=color:#f92672>-</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>17</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>apache<span style=color:#960050;background-color:#1e0010>\</span>logging<span style=color:#960050;background-color:#1e0010>\</span>log4j<span style=color:#960050;background-color:#1e0010>\</span>log4j<span style=color:#f92672>-</span>api<span style=color:#960050;background-color:#1e0010>\</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>17</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#960050;background-color:#1e0010>\</span>log4j<span style=color:#f92672>-</span>api<span style=color:#f92672>-</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>17</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>slf4j<span style=color:#960050;background-color:#1e0010>\</span>jul<span style=color:#f92672>-</span>to<span style=color:#f92672>-</span>slf4j<span style=color:#960050;background-color:#1e0010>\</span>1<span style=color:#f92672>.</span><span style=color:#a6e22e>7</span><span style=color:#f92672>.</span><span style=color:#a6e22e>36</span><span style=color:#960050;background-color:#1e0010>\</span>jul<span style=color:#f92672>-</span>to<span style=color:#f92672>-</span>slf4j<span style=color:#f92672>-</span>1<span style=color:#f92672>.</span><span style=color:#a6e22e>7</span><span style=color:#f92672>.</span><span style=color:#a6e22e>36</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>jakarta<span style=color:#960050;background-color:#1e0010>\</span>annotation<span style=color:#960050;background-color:#1e0010>\</span>jakarta<span style=color:#f92672>.</span><span style=color:#a6e22e>annotation</span><span style=color:#f92672>-</span>api<span style=color:#960050;background-color:#1e0010>\</span>1<span style=color:#f92672>.</span><span style=color:#a6e22e>3</span><span style=color:#f92672>.</span><span style=color:#a6e22e>5</span><span style=color:#960050;background-color:#1e0010>\</span>jakarta<span style=color:#f92672>.</span><span style=color:#a6e22e>annotation</span><span style=color:#f92672>-</span>api<span style=color:#f92672>-</span>1<span style=color:#f92672>.</span><span style=color:#a6e22e>3</span><span style=color:#f92672>.</span><span style=color:#a6e22e>5</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>yaml<span style=color:#960050;background-color:#1e0010>\</span>snakeyaml<span style=color:#960050;background-color:#1e0010>\</span>1<span style=color:#f92672>.</span><span style=color:#a6e22e>29</span><span style=color:#960050;background-color:#1e0010>\</span>snakeyaml<span style=color:#f92672>-</span>1<span style=color:#f92672>.</span><span style=color:#a6e22e>29</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>boot<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>starter<span style=color:#f92672>-</span>json<span style=color:#960050;background-color:#1e0010>\</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>starter<span style=color:#f92672>-</span>json<span style=color:#f92672>-</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>com<span style=color:#960050;background-color:#1e0010>\</span>fasterxml<span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#960050;background-color:#1e0010>\</span>core<span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#f92672>-</span>databind<span style=color:#960050;background-color:#1e0010>\</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>13</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#f92672>-</span>databind<span style=color:#f92672>-</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>13</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>com<span style=color:#960050;background-color:#1e0010>\</span>fasterxml<span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#960050;background-color:#1e0010>\</span>core<span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#f92672>-</span>annotations<span style=color:#960050;background-color:#1e0010>\</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>13</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#f92672>-</span>annotations<span style=color:#f92672>-</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>13</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>com<span style=color:#960050;background-color:#1e0010>\</span>fasterxml<span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#960050;background-color:#1e0010>\</span>core<span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#f92672>-</span>core<span style=color:#960050;background-color:#1e0010>\</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>13</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#f92672>-</span>core<span style=color:#f92672>-</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>13</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>com<span style=color:#960050;background-color:#1e0010>\</span>fasterxml<span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#960050;background-color:#1e0010>\</span>datatype<span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#f92672>-</span>datatype<span style=color:#f92672>-</span>jdk8<span style=color:#960050;background-color:#1e0010>\</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>13</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#f92672>-</span>datatype<span style=color:#f92672>-</span>jdk8<span style=color:#f92672>-</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>13</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>com<span style=color:#960050;background-color:#1e0010>\</span>fasterxml<span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#960050;background-color:#1e0010>\</span>datatype<span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#f92672>-</span>datatype<span style=color:#f92672>-</span>jsr310<span style=color:#960050;background-color:#1e0010>\</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>13</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#f92672>-</span>datatype<span style=color:#f92672>-</span>jsr310<span style=color:#f92672>-</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>13</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>com<span style=color:#960050;background-color:#1e0010>\</span>fasterxml<span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#960050;background-color:#1e0010>\</span>module<span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#f92672>-</span>module<span style=color:#f92672>-</span>parameter<span style=color:#f92672>-</span>names<span style=color:#960050;background-color:#1e0010>\</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>13</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#960050;background-color:#1e0010>\</span>jackson<span style=color:#f92672>-</span>module<span style=color:#f92672>-</span>parameter<span style=color:#f92672>-</span>names<span style=color:#f92672>-</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>13</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>boot<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>starter<span style=color:#f92672>-</span>tomcat<span style=color:#960050;background-color:#1e0010>\</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>starter<span style=color:#f92672>-</span>tomcat<span style=color:#f92672>-</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>apache<span style=color:#960050;background-color:#1e0010>\</span>tomcat<span style=color:#960050;background-color:#1e0010>\</span>embed<span style=color:#960050;background-color:#1e0010>\</span>tomcat<span style=color:#f92672>-</span>embed<span style=color:#f92672>-</span>core<span style=color:#960050;background-color:#1e0010>\</span>9<span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>60</span><span style=color:#960050;background-color:#1e0010>\</span>tomcat<span style=color:#f92672>-</span>embed<span style=color:#f92672>-</span>core<span style=color:#f92672>-</span>9<span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>60</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>apache<span style=color:#960050;background-color:#1e0010>\</span>tomcat<span style=color:#960050;background-color:#1e0010>\</span>embed<span style=color:#960050;background-color:#1e0010>\</span>tomcat<span style=color:#f92672>-</span>embed<span style=color:#f92672>-</span>el<span style=color:#960050;background-color:#1e0010>\</span>9<span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>60</span><span style=color:#960050;background-color:#1e0010>\</span>tomcat<span style=color:#f92672>-</span>embed<span style=color:#f92672>-</span>el<span style=color:#f92672>-</span>9<span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>60</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>apache<span style=color:#960050;background-color:#1e0010>\</span>tomcat<span style=color:#960050;background-color:#1e0010>\</span>embed<span style=color:#960050;background-color:#1e0010>\</span>tomcat<span style=color:#f92672>-</span>embed<span style=color:#f92672>-</span>websocket<span style=color:#960050;background-color:#1e0010>\</span>9<span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>60</span><span style=color:#960050;background-color:#1e0010>\</span>tomcat<span style=color:#f92672>-</span>embed<span style=color:#f92672>-</span>websocket<span style=color:#f92672>-</span>9<span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>60</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>web<span style=color:#960050;background-color:#1e0010>\</span>5<span style=color:#f92672>.</span><span style=color:#a6e22e>3</span><span style=color:#f92672>.</span><span style=color:#a6e22e>18</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>web<span style=color:#f92672>-</span>5<span style=color:#f92672>.</span><span style=color:#a6e22e>3</span><span style=color:#f92672>.</span><span style=color:#a6e22e>18</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>beans<span style=color:#960050;background-color:#1e0010>\</span>5<span style=color:#f92672>.</span><span style=color:#a6e22e>3</span><span style=color:#f92672>.</span><span style=color:#a6e22e>18</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>beans<span style=color:#f92672>-</span>5<span style=color:#f92672>.</span><span style=color:#a6e22e>3</span><span style=color:#f92672>.</span><span style=color:#a6e22e>18</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>webmvc<span style=color:#960050;background-color:#1e0010>\</span>5<span style=color:#f92672>.</span><span style=color:#a6e22e>3</span><span style=color:#f92672>.</span><span style=color:#a6e22e>18</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>webmvc<span style=color:#f92672>-</span>5<span style=color:#f92672>.</span><span style=color:#a6e22e>3</span><span style=color:#f92672>.</span><span style=color:#a6e22e>18</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>aop<span style=color:#960050;background-color:#1e0010>\</span>5<span style=color:#f92672>.</span><span style=color:#a6e22e>3</span><span style=color:#f92672>.</span><span style=color:#a6e22e>18</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>aop<span style=color:#f92672>-</span>5<span style=color:#f92672>.</span><span style=color:#a6e22e>3</span><span style=color:#f92672>.</span><span style=color:#a6e22e>18</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>context<span style=color:#960050;background-color:#1e0010>\</span>5<span style=color:#f92672>.</span><span style=color:#a6e22e>3</span><span style=color:#f92672>.</span><span style=color:#a6e22e>18</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>context<span style=color:#f92672>-</span>5<span style=color:#f92672>.</span><span style=color:#a6e22e>3</span><span style=color:#f92672>.</span><span style=color:#a6e22e>18</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>expression<span style=color:#960050;background-color:#1e0010>\</span>5<span style=color:#f92672>.</span><span style=color:#a6e22e>3</span><span style=color:#f92672>.</span><span style=color:#a6e22e>18</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>expression<span style=color:#f92672>-</span>5<span style=color:#f92672>.</span><span style=color:#a6e22e>3</span><span style=color:#f92672>.</span><span style=color:#a6e22e>18</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>boot<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>devtools<span style=color:#960050;background-color:#1e0010>\</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>devtools<span style=color:#f92672>-</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>boot<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#960050;background-color:#1e0010>\</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>boot<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>autoconfigure<span style=color:#960050;background-color:#1e0010>\</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>boot<span style=color:#f92672>-</span>autoconfigure<span style=color:#f92672>-</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>6</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>projectlombok<span style=color:#960050;background-color:#1e0010>\</span>lombok<span style=color:#960050;background-color:#1e0010>\</span>1<span style=color:#f92672>.</span><span style=color:#a6e22e>18</span><span style=color:#f92672>.</span><span style=color:#a6e22e>22</span><span style=color:#960050;background-color:#1e0010>\</span>lombok<span style=color:#f92672>-</span>1<span style=color:#f92672>.</span><span style=color:#a6e22e>18</span><span style=color:#f92672>.</span><span style=color:#a6e22e>22</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>slf4j<span style=color:#960050;background-color:#1e0010>\</span>slf4j<span style=color:#f92672>-</span>api<span style=color:#960050;background-color:#1e0010>\</span>1<span style=color:#f92672>.</span><span style=color:#a6e22e>7</span><span style=color:#f92672>.</span><span style=color:#a6e22e>36</span><span style=color:#960050;background-color:#1e0010>\</span>slf4j<span style=color:#f92672>-</span>api<span style=color:#f92672>-</span>1<span style=color:#f92672>.</span><span style=color:#a6e22e>7</span><span style=color:#f92672>.</span><span style=color:#a6e22e>36</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>core<span style=color:#960050;background-color:#1e0010>\</span>5<span style=color:#f92672>.</span><span style=color:#a6e22e>3</span><span style=color:#f92672>.</span><span style=color:#a6e22e>18</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>core<span style=color:#f92672>-</span>5<span style=color:#f92672>.</span><span style=color:#a6e22e>3</span><span style=color:#f92672>.</span><span style=color:#a6e22e>18</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>springframework<span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>jcl<span style=color:#960050;background-color:#1e0010>\</span>5<span style=color:#f92672>.</span><span style=color:#a6e22e>3</span><span style=color:#f92672>.</span><span style=color:#a6e22e>18</span><span style=color:#960050;background-color:#1e0010>\</span>spring<span style=color:#f92672>-</span>jcl<span style=color:#f92672>-</span>5<span style=color:#f92672>.</span><span style=color:#a6e22e>3</span><span style=color:#f92672>.</span><span style=color:#a6e22e>18</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>com<span style=color:#960050;background-color:#1e0010>\</span>google<span style=color:#960050;background-color:#1e0010>\</span>guava<span style=color:#960050;background-color:#1e0010>\</span>guava<span style=color:#960050;background-color:#1e0010>\</span>31<span style=color:#f92672>.</span><span style=color:#a6e22e>1</span><span style=color:#f92672>-</span>jre<span style=color:#960050;background-color:#1e0010>\</span>guava<span style=color:#f92672>-</span>31<span style=color:#f92672>.</span><span style=color:#a6e22e>1</span><span style=color:#f92672>-</span>jre<span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>com<span style=color:#960050;background-color:#1e0010>\</span>google<span style=color:#960050;background-color:#1e0010>\</span>guava<span style=color:#960050;background-color:#1e0010>\</span>failureaccess<span style=color:#960050;background-color:#1e0010>\</span>1<span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>1</span><span style=color:#960050;background-color:#1e0010>\</span>failureaccess<span style=color:#f92672>-</span>1<span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>1</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>com<span style=color:#960050;background-color:#1e0010>\</span>google<span style=color:#960050;background-color:#1e0010>\</span>guava<span style=color:#960050;background-color:#1e0010>\</span>listenablefuture<span style=color:#960050;background-color:#1e0010>\</span>9999<span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>-</span>empty<span style=color:#f92672>-</span>to<span style=color:#f92672>-</span>avoid<span style=color:#f92672>-</span>conflict<span style=color:#f92672>-</span>with<span style=color:#f92672>-</span>guava<span style=color:#960050;background-color:#1e0010>\</span>listenablefuture<span style=color:#f92672>-</span>9999<span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>-</span>empty<span style=color:#f92672>-</span>to<span style=color:#f92672>-</span>avoid<span style=color:#f92672>-</span>conflict<span style=color:#f92672>-</span>with<span style=color:#f92672>-</span>guava<span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>com<span style=color:#960050;background-color:#1e0010>\</span>google<span style=color:#960050;background-color:#1e0010>\</span>code<span style=color:#960050;background-color:#1e0010>\</span>findbugs<span style=color:#960050;background-color:#1e0010>\</span>jsr305<span style=color:#960050;background-color:#1e0010>\</span>3<span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#960050;background-color:#1e0010>\</span>jsr305<span style=color:#f92672>-</span>3<span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>org<span style=color:#960050;background-color:#1e0010>\</span>checkerframework<span style=color:#960050;background-color:#1e0010>\</span>checker<span style=color:#f92672>-</span>qual<span style=color:#960050;background-color:#1e0010>\</span>3<span style=color:#f92672>.</span><span style=color:#a6e22e>12</span><span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#960050;background-color:#1e0010>\</span>checker<span style=color:#f92672>-</span>qual<span style=color:#f92672>-</span>3<span style=color:#f92672>.</span><span style=color:#a6e22e>12</span><span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>com<span style=color:#960050;background-color:#1e0010>\</span>google<span style=color:#960050;background-color:#1e0010>\</span>errorprone<span style=color:#960050;background-color:#1e0010>\</span>error_prone_annotations<span style=color:#960050;background-color:#1e0010>\</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>11</span><span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#960050;background-color:#1e0010>\</span>error_prone_annotations<span style=color:#f92672>-</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>11</span><span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>com<span style=color:#960050;background-color:#1e0010>\</span>google<span style=color:#960050;background-color:#1e0010>\</span>j2objc<span style=color:#960050;background-color:#1e0010>\</span>j2objc<span style=color:#f92672>-</span>annotations<span style=color:#960050;background-color:#1e0010>\</span>1<span style=color:#f92672>.</span><span style=color:#a6e22e>3</span><span style=color:#960050;background-color:#1e0010>\</span>j2objc<span style=color:#f92672>-</span>annotations<span style=color:#f92672>-</span>1<span style=color:#f92672>.</span><span style=color:#a6e22e>3</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span><span style=color:#f92672>;</span>D<span style=color:#f92672>:</span><span style=color:#960050;background-color:#1e0010>\</span>Tools<span style=color:#960050;background-color:#1e0010>\</span>repo<span style=color:#960050;background-color:#1e0010>\</span>joda<span style=color:#f92672>-</span>time<span style=color:#960050;background-color:#1e0010>\</span>joda<span style=color:#f92672>-</span>time<span style=color:#960050;background-color:#1e0010>\</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>9</span><span style=color:#f92672>.</span><span style=color:#a6e22e>9</span><span style=color:#960050;background-color:#1e0010>\</span>joda<span style=color:#f92672>-</span>time<span style=color:#f92672>-</span>2<span style=color:#f92672>.</span><span style=color:#a6e22e>9</span><span style=color:#f92672>.</span><span style=color:#a6e22e>9</span><span style=color:#f92672>.</span><span style=color:#a6e22e>jar</span> com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span>
</span></span><span style=display:flex><span>20:53<span style=color:#f92672>:</span>22<span style=color:#f92672>.</span><span style=color:#a6e22e>696</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>2<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>1<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:53<span style=color:#f92672>:</span>22<span style=color:#f92672>.</span><span style=color:#a6e22e>696</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>3<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>2<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:53<span style=color:#f92672>:</span>22<span style=color:#f92672>.</span><span style=color:#a6e22e>696</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>0<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:53<span style=color:#f92672>:</span>23<span style=color:#f92672>.</span><span style=color:#a6e22e>707</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>5<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>4<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:53<span style=color:#f92672>:</span>23<span style=color:#f92672>.</span><span style=color:#a6e22e>707</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>6<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>5<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:53<span style=color:#f92672>:</span>23<span style=color:#f92672>.</span><span style=color:#a6e22e>707</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>7<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>6<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:53<span style=color:#f92672>:</span>24<span style=color:#f92672>.</span><span style=color:#a6e22e>711</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>13<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>12<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:53<span style=color:#f92672>:</span>24<span style=color:#f92672>.</span><span style=color:#a6e22e>711</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>8<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>7<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:53<span style=color:#f92672>:</span>24<span style=color:#f92672>.</span><span style=color:#a6e22e>711</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>4<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>3<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:53<span style=color:#f92672>:</span>25<span style=color:#f92672>.</span><span style=color:#a6e22e>726</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>9<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>8<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:53<span style=color:#f92672>:</span>25<span style=color:#f92672>.</span><span style=color:#a6e22e>726</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>12<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>11<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:53<span style=color:#f92672>:</span>25<span style=color:#f92672>.</span><span style=color:#a6e22e>726</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>14<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>13<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:53<span style=color:#f92672>:</span>26<span style=color:#f92672>.</span><span style=color:#a6e22e>738</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>16<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>15<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:53<span style=color:#f92672>:</span>26<span style=color:#f92672>.</span><span style=color:#a6e22e>738</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>11<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>10<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:53<span style=color:#f92672>:</span>26<span style=color:#f92672>.</span><span style=color:#a6e22e>738</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>10<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>9<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:53<span style=color:#f92672>:</span>27<span style=color:#f92672>.</span><span style=color:#a6e22e>741</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>18<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>17<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:53<span style=color:#f92672>:</span>27<span style=color:#f92672>.</span><span style=color:#a6e22e>741</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>17<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>16<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:53<span style=color:#f92672>:</span>27<span style=color:#f92672>.</span><span style=color:#a6e22e>741</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>15<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>14<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:53<span style=color:#f92672>:</span>28<span style=color:#f92672>.</span><span style=color:#a6e22e>741</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>19<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>18<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:53<span style=color:#f92672>:</span>28<span style=color:#f92672>.</span><span style=color:#a6e22e>741</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>20<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>19<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Process finished with exit code 0
</span></span></code></pre></div><p>通过结果可以看到，每秒只打印2个数字，就是信号量控制的。</p><h2 id=示例二>示例二</h2><p>同时获取多个许可，释放多个许可，也可以一个一个释放许可。下面代码示例，只有2个并发线程所有，获取后没有了，就类似单线程。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.yanxizhu.demo.concurrency.aqs<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.yanxizhu.demo.concurrency.annotation.ThreadSafety<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> lombok.extern.slf4j.Slf4j<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.ExecutorService<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.Executors<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.Semaphore<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @description: Semaphore-信号量，控制线程并发数，可以获取或释放多个许可
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author: &lt;a href=&#34;mailto:batis@foxmail.com&#34;&gt;清风&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @date: 2022/4/25 20:41
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @version: 1.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@ThreadSafety</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> threadNum <span style=color:#f92672>=</span> 20<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> currentThreadNum <span style=color:#f92672>=</span> 3<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//线程池
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        ExecutorService executorService <span style=color:#f92672>=</span> Executors<span style=color:#f92672>.</span><span style=color:#a6e22e>newCachedThreadPool</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//信号量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        Semaphore semaphore <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Semaphore<span style=color:#f92672>(</span>currentThreadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span>threadNum<span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> num <span style=color:#f92672>=</span> i<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>//获取3个许可，需要等3个都执行完了，才释放3个许可
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    semaphore<span style=color:#f92672>.</span><span style=color:#a6e22e>acquire</span><span style=color:#f92672>(</span>3<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                    pringNum<span style=color:#f92672>(</span>num<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>//释放3个许可
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    semaphore<span style=color:#f92672>.</span><span style=color:#a6e22e>release</span><span style=color:#f92672>(</span>3<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span><span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                    log<span style=color:#f92672>.</span><span style=color:#a6e22e>error</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;执行错误【{}】&#34;</span><span style=color:#f92672>,</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>shutdown</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>pringNum</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> num<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;num=【{}】&#34;</span><span style=color:#f92672>,</span> num<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span>1000<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>输出结果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>20:56<span style=color:#f92672>:</span>17<span style=color:#f92672>.</span><span style=color:#a6e22e>733</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>0<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:56<span style=color:#f92672>:</span>18<span style=color:#f92672>.</span><span style=color:#a6e22e>740</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>2<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>1<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:56<span style=color:#f92672>:</span>19<span style=color:#f92672>.</span><span style=color:#a6e22e>754</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>6<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>5<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:56<span style=color:#f92672>:</span>20<span style=color:#f92672>.</span><span style=color:#a6e22e>755</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>7<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>6<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:56<span style=color:#f92672>:</span>21<span style=color:#f92672>.</span><span style=color:#a6e22e>767</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>10<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>9<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:56<span style=color:#f92672>:</span>22<span style=color:#f92672>.</span><span style=color:#a6e22e>780</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>8<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>7<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:56<span style=color:#f92672>:</span>23<span style=color:#f92672>.</span><span style=color:#a6e22e>791</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>5<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>4<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:56<span style=color:#f92672>:</span>24<span style=color:#f92672>.</span><span style=color:#a6e22e>800</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>9<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>8<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:56<span style=color:#f92672>:</span>25<span style=color:#f92672>.</span><span style=color:#a6e22e>801</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>4<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>3<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:56<span style=color:#f92672>:</span>26<span style=color:#f92672>.</span><span style=color:#a6e22e>812</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>3<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>2<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:56<span style=color:#f92672>:</span>27<span style=color:#f92672>.</span><span style=color:#a6e22e>824</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>11<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>10<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:56<span style=color:#f92672>:</span>28<span style=color:#f92672>.</span><span style=color:#a6e22e>834</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>12<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>11<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:56<span style=color:#f92672>:</span>29<span style=color:#f92672>.</span><span style=color:#a6e22e>847</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>13<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>12<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:56<span style=color:#f92672>:</span>30<span style=color:#f92672>.</span><span style=color:#a6e22e>850</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>14<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>13<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:56<span style=color:#f92672>:</span>31<span style=color:#f92672>.</span><span style=color:#a6e22e>853</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>17<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>16<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:56<span style=color:#f92672>:</span>32<span style=color:#f92672>.</span><span style=color:#a6e22e>863</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>15<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>14<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:56<span style=color:#f92672>:</span>33<span style=color:#f92672>.</span><span style=color:#a6e22e>873</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>16<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>15<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:56<span style=color:#f92672>:</span>34<span style=color:#f92672>.</span><span style=color:#a6e22e>885</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>18<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>17<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:56<span style=color:#f92672>:</span>35<span style=color:#f92672>.</span><span style=color:#a6e22e>885</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>19<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>18<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>20:56<span style=color:#f92672>:</span>36<span style=color:#f92672>.</span><span style=color:#a6e22e>897</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>20<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo2</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>19<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>Disconnected from the target VM<span style=color:#f92672>,</span> address<span style=color:#f92672>:</span> <span style=color:#960050;background-color:#1e0010>&#39;</span>127<span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>1</span><span style=color:#f92672>:</span>13050<span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#f92672>,</span> transport<span style=color:#f92672>:</span> <span style=color:#960050;background-color:#1e0010>&#39;</span>socket<span style=color:#960050;background-color:#1e0010>&#39;</span>
</span></span></code></pre></div><h2 id=示例三>示例三</h2><p>当线程数超过并发数，就丢失多余的。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.yanxizhu.demo.concurrency.aqs<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.yanxizhu.demo.concurrency.annotation.ThreadSafety<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> lombok.extern.slf4j.Slf4j<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.ExecutorService<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.Executors<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.Semaphore<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @description: Semaphore-信号量，控制线程并发数，超过并发量时掉漆多余线程
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author: &lt;a href=&#34;mailto:batis@foxmail.com&#34;&gt;清风&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @date: 2022/4/25 20:41
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @version: 1.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@ThreadSafety</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SemaphoreDemo3</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> threadNum <span style=color:#f92672>=</span> 20<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> currentThreadNum <span style=color:#f92672>=</span> 3<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//线程池
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        ExecutorService executorService <span style=color:#f92672>=</span> Executors<span style=color:#f92672>.</span><span style=color:#a6e22e>newCachedThreadPool</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//信号量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        Semaphore semaphore <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Semaphore<span style=color:#f92672>(</span>currentThreadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span>threadNum<span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> num <span style=color:#f92672>=</span> i<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>//尝试获取许可，获取到才执行
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>semaphore<span style=color:#f92672>.</span><span style=color:#a6e22e>tryAcquire</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                        pringNum<span style=color:#f92672>(</span>num<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                        <span style=color:#75715e>//释放一个许可
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                        semaphore<span style=color:#f92672>.</span><span style=color:#a6e22e>release</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span><span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                    log<span style=color:#f92672>.</span><span style=color:#a6e22e>error</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;执行错误【{}】&#34;</span><span style=color:#f92672>,</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>shutdown</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>pringNum</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> num<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;num=【{}】&#34;</span><span style=color:#f92672>,</span> num<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span>1000<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>输出结果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>21:04<span style=color:#f92672>:</span>48<span style=color:#f92672>.</span><span style=color:#a6e22e>376</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo3</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>0<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>21:04<span style=color:#f92672>:</span>49<span style=color:#f92672>.</span><span style=color:#a6e22e>387</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>2<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo3</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>1<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>Disconnected from the target VM<span style=color:#f92672>,</span> address<span style=color:#f92672>:</span> <span style=color:#960050;background-color:#1e0010>&#39;</span>127<span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>1</span><span style=color:#f92672>:</span>2839<span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#f92672>,</span> transport<span style=color:#f92672>:</span> <span style=color:#960050;background-color:#1e0010>&#39;</span>socket<span style=color:#960050;background-color:#1e0010>&#39;</span>
</span></span></code></pre></div><p>只输出2个线程，其它18个线程被丢弃。</p><p>tryAcquire方法重载说明：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>//无参
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>tryAcquire</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> sync<span style=color:#f92672>.</span><span style=color:#a6e22e>nonfairTryAcquireShared</span><span style=color:#f92672>(</span>1<span style=color:#f92672>)</span> <span style=color:#f92672>&gt;=</span> 0<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//1个参数，获取许可个数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>tryAcquire</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> permits<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>permits <span style=color:#f92672>&lt;</span> 0<span style=color:#f92672>)</span> <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IllegalArgumentException<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> sync<span style=color:#f92672>.</span><span style=color:#a6e22e>nonfairTryAcquireShared</span><span style=color:#f92672>(</span>permits<span style=color:#f92672>)</span> <span style=color:#f92672>&gt;=</span> 0<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//2个参数，超时时间，单位
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>tryAcquire</span><span style=color:#f92672>(</span><span style=color:#66d9ef>long</span> timeout<span style=color:#f92672>,</span> TimeUnit unit<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> sync<span style=color:#f92672>.</span><span style=color:#a6e22e>tryAcquireSharedNanos</span><span style=color:#f92672>(</span>1<span style=color:#f92672>,</span> unit<span style=color:#f92672>.</span><span style=color:#a6e22e>toNanos</span><span style=color:#f92672>(</span>timeout<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//3个参数，获取许可个数，超时时间，单位
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>tryAcquire</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> permits<span style=color:#f92672>,</span> <span style=color:#66d9ef>long</span> timeout<span style=color:#f92672>,</span> TimeUnit unit<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>permits <span style=color:#f92672>&lt;</span> 0<span style=color:#f92672>)</span> <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IllegalArgumentException<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> sync<span style=color:#f92672>.</span><span style=color:#a6e22e>tryAcquireSharedNanos</span><span style=color:#f92672>(</span>permits<span style=color:#f92672>,</span> unit<span style=color:#f92672>.</span><span style=color:#a6e22e>toNanos</span><span style=color:#f92672>(</span>timeout<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=示例四>示例四</h2><p>设置超时时间</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.yanxizhu.demo.concurrency.aqs<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.yanxizhu.demo.concurrency.annotation.ThreadSafety<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> lombok.extern.slf4j.Slf4j<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.ExecutorService<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.Executors<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.Semaphore<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.TimeUnit<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @description: Semaphore-信号量，控制线程并发数，带超时时间限制的
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author: &lt;a href=&#34;mailto:batis@foxmail.com&#34;&gt;清风&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @date: 2022/4/25 20:41
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @version: 1.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@ThreadSafety</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SemaphoreDemo4</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> threadNum <span style=color:#f92672>=</span> 50<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> currentThreadNum <span style=color:#f92672>=</span> 3<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//线程池
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        ExecutorService executorService <span style=color:#f92672>=</span> Executors<span style=color:#f92672>.</span><span style=color:#a6e22e>newCachedThreadPool</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//信号量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        Semaphore semaphore <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Semaphore<span style=color:#f92672>(</span>currentThreadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span>threadNum<span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> num <span style=color:#f92672>=</span> i<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>//尝试获取许可，获取到才执行，获取超过3秒，就不执行了。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>semaphore<span style=color:#f92672>.</span><span style=color:#a6e22e>tryAcquire</span><span style=color:#f92672>(</span>3000<span style=color:#f92672>,</span> TimeUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>MILLISECONDS</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                        pringNum<span style=color:#f92672>(</span>num<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                        <span style=color:#75715e>//释放一个许可
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                        semaphore<span style=color:#f92672>.</span><span style=color:#a6e22e>release</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span><span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>                    log<span style=color:#f92672>.</span><span style=color:#a6e22e>error</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;执行错误【{}】&#34;</span><span style=color:#f92672>,</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>shutdown</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>pringNum</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> num<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;num=【{}】&#34;</span><span style=color:#f92672>,</span> num<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span>1000<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>输出结果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>22:01<span style=color:#f92672>:</span>36<span style=color:#f92672>.</span><span style=color:#a6e22e>804</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo4</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>0<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>22:01<span style=color:#f92672>:</span>36<span style=color:#f92672>.</span><span style=color:#a6e22e>804</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>3<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo4</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>2<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>22:01<span style=color:#f92672>:</span>36<span style=color:#f92672>.</span><span style=color:#a6e22e>804</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>2<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo4</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>1<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>22:01<span style=color:#f92672>:</span>37<span style=color:#f92672>.</span><span style=color:#a6e22e>828</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>4<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo4</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>3<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>22:01<span style=color:#f92672>:</span>37<span style=color:#f92672>.</span><span style=color:#a6e22e>828</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>6<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo4</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>5<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>22:01<span style=color:#f92672>:</span>37<span style=color:#f92672>.</span><span style=color:#a6e22e>828</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>10<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo4</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>9<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>22:01<span style=color:#f92672>:</span>38<span style=color:#f92672>.</span><span style=color:#a6e22e>843</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>12<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo4</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>11<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>22:01<span style=color:#f92672>:</span>38<span style=color:#f92672>.</span><span style=color:#a6e22e>843</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>13<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo4</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>12<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>22:01<span style=color:#f92672>:</span>38<span style=color:#f92672>.</span><span style=color:#a6e22e>843</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>8<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>SemaphoreDemo4</span> <span style=color:#f92672>-</span> num<span style=color:#f92672>=</span><span style=color:#960050;background-color:#1e0010>【</span>7<span style=color:#960050;background-color:#1e0010>】</span>
</span></span><span style=display:flex><span>Disconnected from the target VM<span style=color:#f92672>,</span> address<span style=color:#f92672>:</span> <span style=color:#960050;background-color:#1e0010>&#39;</span>127<span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>1</span><span style=color:#f92672>:</span>11385<span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#f92672>,</span> transport<span style=color:#f92672>:</span> <span style=color:#960050;background-color:#1e0010>&#39;</span>socket<span style=color:#960050;background-color:#1e0010>&#39;</span>
</span></span></code></pre></div><h1 id=3cyclicbarrier>3、CyclicBarrier</h1><p>允许一组线程相互等待，直到达到某个共同屏障点，直到每个线程都就绪后面的才继续往下执行。和CoutDownLatch相似都是通过计数器来实现的，图从下往上看的。线程释放后可以循环使用，因此也叫循环屏障。CoutDownLatch用户分计算，汇总最后的结果。</p><p><img src=https://cdn.jsdelivr.net/gh/willxwu/CDN@main/images/202204252203522.png alt></p><h2 id=示例一-3>示例一</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.yanxizhu.demo.concurrency.aqs<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> lombok.extern.slf4j.Slf4j<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.BrokenBarrierException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.CyclicBarrier<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.ExecutorService<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.Executors<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @description: CyclicBarrier 实现线程相互等待
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author: &lt;a href=&#34;mailto:batis@foxmail.com&#34;&gt;清风&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @date: 2022/4/25 22:15
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @version: 1.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//定义需要相互等待5个线程，就绪后才执行，后面的代码
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> CyclicBarrier cyclicBarrier <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CyclicBarrier<span style=color:#f92672>(</span>4<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//线程池
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        ExecutorService executorService <span style=color:#f92672>=</span> Executors<span style=color:#f92672>.</span><span style=color:#a6e22e>newCachedThreadPool</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span> 10<span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> threadNum <span style=color:#f92672>=</span> i<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//模式看效果，等待1秒
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span>1000<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    pringWait<span style=color:#f92672>(</span>threadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    log<span style=color:#f92672>.</span><span style=color:#a6e22e>error</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;执行出错了。。。&#34;</span><span style=color:#f92672>,</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>shutdown</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>pringWait</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> threadNum<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException<span style=color:#f92672>,</span> BrokenBarrierException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//模式看效果，等待1秒
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span>1000<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;等待中。。。{}&#34;</span><span style=color:#f92672>,</span> threadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//告诉线程每个就绪了，await方法支持传入超时时间
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//可选参数long timeout, TimeUnit unit
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        cyclicBarrier<span style=color:#f92672>.</span><span style=color:#a6e22e>await</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//就绪后才执行
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;开始执行了。。{}&#34;</span><span style=color:#f92672>,</span>threadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>输出结果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Connected to the target VM<span style=color:#f92672>,</span> address<span style=color:#f92672>:</span> <span style=color:#960050;background-color:#1e0010>&#39;</span>127<span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>1</span><span style=color:#f92672>:</span>14410<span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#f92672>,</span> transport<span style=color:#f92672>:</span> <span style=color:#960050;background-color:#1e0010>&#39;</span>socket<span style=color:#960050;background-color:#1e0010>&#39;</span>
</span></span><span style=display:flex><span>22:26<span style=color:#f92672>:</span>04<span style=color:#f92672>.</span><span style=color:#a6e22e>855</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>0
</span></span><span style=display:flex><span>22:26<span style=color:#f92672>:</span>05<span style=color:#f92672>.</span><span style=color:#a6e22e>853</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>2<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>1
</span></span><span style=display:flex><span>22:26<span style=color:#f92672>:</span>06<span style=color:#f92672>.</span><span style=color:#a6e22e>866</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>3<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>2
</span></span><span style=display:flex><span>22:26<span style=color:#f92672>:</span>07<span style=color:#f92672>.</span><span style=color:#a6e22e>881</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>4<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>3
</span></span><span style=display:flex><span>22:26<span style=color:#f92672>:</span>07<span style=color:#f92672>.</span><span style=color:#a6e22e>881</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>4<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>3
</span></span><span style=display:flex><span>22:26<span style=color:#f92672>:</span>07<span style=color:#f92672>.</span><span style=color:#a6e22e>882</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>2<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>1
</span></span><span style=display:flex><span>22:26<span style=color:#f92672>:</span>07<span style=color:#f92672>.</span><span style=color:#a6e22e>882</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>3<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>2
</span></span><span style=display:flex><span>22:26<span style=color:#f92672>:</span>07<span style=color:#f92672>.</span><span style=color:#a6e22e>881</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>0
</span></span><span style=display:flex><span>22:26<span style=color:#f92672>:</span>08<span style=color:#f92672>.</span><span style=color:#a6e22e>896</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>5<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>4
</span></span><span style=display:flex><span>22:26<span style=color:#f92672>:</span>09<span style=color:#f92672>.</span><span style=color:#a6e22e>899</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>5
</span></span><span style=display:flex><span>22:26<span style=color:#f92672>:</span>10<span style=color:#f92672>.</span><span style=color:#a6e22e>901</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>2<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>6
</span></span><span style=display:flex><span>22:26<span style=color:#f92672>:</span>11<span style=color:#f92672>.</span><span style=color:#a6e22e>902</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>3<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>7
</span></span><span style=display:flex><span>22:26<span style=color:#f92672>:</span>11<span style=color:#f92672>.</span><span style=color:#a6e22e>902</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>3<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>7
</span></span><span style=display:flex><span>22:26<span style=color:#f92672>:</span>11<span style=color:#f92672>.</span><span style=color:#a6e22e>902</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>5<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>4
</span></span><span style=display:flex><span>22:26<span style=color:#f92672>:</span>11<span style=color:#f92672>.</span><span style=color:#a6e22e>902</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>2<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>6
</span></span><span style=display:flex><span>22:26<span style=color:#f92672>:</span>11<span style=color:#f92672>.</span><span style=color:#a6e22e>902</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>5
</span></span><span style=display:flex><span>22:26<span style=color:#f92672>:</span>12<span style=color:#f92672>.</span><span style=color:#a6e22e>903</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>4<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>8
</span></span><span style=display:flex><span>22:26<span style=color:#f92672>:</span>13<span style=color:#f92672>.</span><span style=color:#a6e22e>916</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>9
</span></span><span style=display:flex><span>Disconnected from the target VM<span style=color:#f92672>,</span> address<span style=color:#f92672>:</span> <span style=color:#960050;background-color:#1e0010>&#39;</span>127<span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>1</span><span style=color:#f92672>:</span>14410<span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#f92672>,</span> transport<span style=color:#f92672>:</span> <span style=color:#960050;background-color:#1e0010>&#39;</span>socket<span style=color:#960050;background-color:#1e0010>&#39;</span>
</span></span></code></pre></div><h2 id=示例二-1>示例二</h2><p>带超时时间的，注意需要trycatch才能不影响后续流程执行。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.yanxizhu.demo.concurrency.aqs<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> lombok.extern.slf4j.Slf4j<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.*<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @description: CyclicBarrier 实现线程相互等待,带超时时间，注意捕获异常，才能继续执行后面的操作
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author: &lt;a href=&#34;mailto:batis@foxmail.com&#34;&gt;清风&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @date: 2022/4/25 22:15
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @version: 1.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//定义需要相互等待5个线程，就绪后才执行，后面的代码
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> CyclicBarrier cyclicBarrier <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CyclicBarrier<span style=color:#f92672>(</span>4<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//线程池
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        ExecutorService executorService <span style=color:#f92672>=</span> Executors<span style=color:#f92672>.</span><span style=color:#a6e22e>newCachedThreadPool</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span> 10<span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> threadNum <span style=color:#f92672>=</span> i<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//模式看效果，等待1秒
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span>1000<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    pringWait<span style=color:#f92672>(</span>threadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    log<span style=color:#f92672>.</span><span style=color:#a6e22e>error</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;执行出错了。。。&#34;</span><span style=color:#f92672>,</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>shutdown</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>pringWait</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> threadNum<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException<span style=color:#f92672>,</span> BrokenBarrierException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//模式看效果，等待1秒
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span>1000<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;等待中。。。{}&#34;</span><span style=color:#f92672>,</span> threadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//告诉线程每个就绪了，带超时时间
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            cyclicBarrier<span style=color:#f92672>.</span><span style=color:#a6e22e>await</span><span style=color:#f92672>(</span>2000<span style=color:#f92672>,</span> TimeUnit<span style=color:#f92672>.</span><span style=color:#a6e22e>MILLISECONDS</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>            log<span style=color:#f92672>.</span><span style=color:#a6e22e>warn</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;超时了，注意：捕获异常，才能继续执行&#34;</span><span style=color:#f92672>,</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//就绪后才执行
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;开始执行了。。{}&#34;</span><span style=color:#f92672>,</span>threadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>输出结果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>22:37<span style=color:#f92672>:</span>57<span style=color:#f92672>.</span><span style=color:#a6e22e>786</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>0
</span></span><span style=display:flex><span>22:37<span style=color:#f92672>:</span>58<span style=color:#f92672>.</span><span style=color:#a6e22e>797</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>2<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>1
</span></span><span style=display:flex><span>22:37<span style=color:#f92672>:</span>59<span style=color:#f92672>.</span><span style=color:#a6e22e>797</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> WARN com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 超时了<span style=color:#960050;background-color:#1e0010>，</span>注意<span style=color:#960050;background-color:#1e0010>：</span>捕获异常<span style=color:#960050;background-color:#1e0010>，</span>才能继续执行
</span></span><span style=display:flex><span>22:37<span style=color:#f92672>:</span>59<span style=color:#f92672>.</span><span style=color:#a6e22e>797</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>2<span style=color:#f92672>]</span> WARN com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 超时了<span style=color:#960050;background-color:#1e0010>，</span>注意<span style=color:#960050;background-color:#1e0010>：</span>捕获异常<span style=color:#960050;background-color:#1e0010>，</span>才能继续执行
</span></span><span style=display:flex><span>22:37<span style=color:#f92672>:</span>59<span style=color:#f92672>.</span><span style=color:#a6e22e>797</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>0
</span></span><span style=display:flex><span>22:37<span style=color:#f92672>:</span>59<span style=color:#f92672>.</span><span style=color:#a6e22e>798</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>2<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>1
</span></span><span style=display:flex><span>22:37<span style=color:#f92672>:</span>59<span style=color:#f92672>.</span><span style=color:#a6e22e>812</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>3<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>2
</span></span><span style=display:flex><span>22:37<span style=color:#f92672>:</span>59<span style=color:#f92672>.</span><span style=color:#a6e22e>812</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>3<span style=color:#f92672>]</span> WARN com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 超时了<span style=color:#960050;background-color:#1e0010>，</span>注意<span style=color:#960050;background-color:#1e0010>：</span>捕获异常<span style=color:#960050;background-color:#1e0010>，</span>才能继续执行
</span></span><span style=display:flex><span>22:37<span style=color:#f92672>:</span>59<span style=color:#f92672>.</span><span style=color:#a6e22e>812</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>3<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>2
</span></span><span style=display:flex><span>22:38<span style=color:#f92672>:</span>00<span style=color:#f92672>.</span><span style=color:#a6e22e>813</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>3
</span></span><span style=display:flex><span>22:38<span style=color:#f92672>:</span>00<span style=color:#f92672>.</span><span style=color:#a6e22e>813</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> WARN com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 超时了<span style=color:#960050;background-color:#1e0010>，</span>注意<span style=color:#960050;background-color:#1e0010>：</span>捕获异常<span style=color:#960050;background-color:#1e0010>，</span>才能继续执行
</span></span><span style=display:flex><span>22:38<span style=color:#f92672>:</span>00<span style=color:#f92672>.</span><span style=color:#a6e22e>813</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>3
</span></span><span style=display:flex><span>22:38<span style=color:#f92672>:</span>01<span style=color:#f92672>.</span><span style=color:#a6e22e>828</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>3<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>4
</span></span><span style=display:flex><span>22:38<span style=color:#f92672>:</span>01<span style=color:#f92672>.</span><span style=color:#a6e22e>828</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>3<span style=color:#f92672>]</span> WARN com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 超时了<span style=color:#960050;background-color:#1e0010>，</span>注意<span style=color:#960050;background-color:#1e0010>：</span>捕获异常<span style=color:#960050;background-color:#1e0010>，</span>才能继续执行
</span></span><span style=display:flex><span>22:38<span style=color:#f92672>:</span>01<span style=color:#f92672>.</span><span style=color:#a6e22e>828</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>3<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>4
</span></span><span style=display:flex><span>22:38<span style=color:#f92672>:</span>02<span style=color:#f92672>.</span><span style=color:#a6e22e>840</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>5
</span></span><span style=display:flex><span>22:38<span style=color:#f92672>:</span>02<span style=color:#f92672>.</span><span style=color:#a6e22e>840</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> WARN com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 超时了<span style=color:#960050;background-color:#1e0010>，</span>注意<span style=color:#960050;background-color:#1e0010>：</span>捕获异常<span style=color:#960050;background-color:#1e0010>，</span>才能继续执行
</span></span><span style=display:flex><span>22:38<span style=color:#f92672>:</span>02<span style=color:#f92672>.</span><span style=color:#a6e22e>840</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>5
</span></span><span style=display:flex><span>22:38<span style=color:#f92672>:</span>03<span style=color:#f92672>.</span><span style=color:#a6e22e>842</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>3<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>6
</span></span><span style=display:flex><span>22:38<span style=color:#f92672>:</span>03<span style=color:#f92672>.</span><span style=color:#a6e22e>842</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>3<span style=color:#f92672>]</span> WARN com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 超时了<span style=color:#960050;background-color:#1e0010>，</span>注意<span style=color:#960050;background-color:#1e0010>：</span>捕获异常<span style=color:#960050;background-color:#1e0010>，</span>才能继续执行
</span></span><span style=display:flex><span>22:38<span style=color:#f92672>:</span>03<span style=color:#f92672>.</span><span style=color:#a6e22e>842</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>3<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>6
</span></span><span style=display:flex><span>22:38<span style=color:#f92672>:</span>04<span style=color:#f92672>.</span><span style=color:#a6e22e>855</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>7
</span></span><span style=display:flex><span>22:38<span style=color:#f92672>:</span>04<span style=color:#f92672>.</span><span style=color:#a6e22e>855</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> WARN com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 超时了<span style=color:#960050;background-color:#1e0010>，</span>注意<span style=color:#960050;background-color:#1e0010>：</span>捕获异常<span style=color:#960050;background-color:#1e0010>，</span>才能继续执行
</span></span><span style=display:flex><span>22:38<span style=color:#f92672>:</span>04<span style=color:#f92672>.</span><span style=color:#a6e22e>855</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>7
</span></span><span style=display:flex><span>22:38<span style=color:#f92672>:</span>05<span style=color:#f92672>.</span><span style=color:#a6e22e>870</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>3<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>8
</span></span><span style=display:flex><span>22:38<span style=color:#f92672>:</span>05<span style=color:#f92672>.</span><span style=color:#a6e22e>870</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>3<span style=color:#f92672>]</span> WARN com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 超时了<span style=color:#960050;background-color:#1e0010>，</span>注意<span style=color:#960050;background-color:#1e0010>：</span>捕获异常<span style=color:#960050;background-color:#1e0010>，</span>才能继续执行
</span></span><span style=display:flex><span>22:38<span style=color:#f92672>:</span>05<span style=color:#f92672>.</span><span style=color:#a6e22e>870</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>3<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>8
</span></span><span style=display:flex><span>22:38<span style=color:#f92672>:</span>06<span style=color:#f92672>.</span><span style=color:#a6e22e>870</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>9
</span></span><span style=display:flex><span>22:38<span style=color:#f92672>:</span>06<span style=color:#f92672>.</span><span style=color:#a6e22e>870</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> WARN com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 超时了<span style=color:#960050;background-color:#1e0010>，</span>注意<span style=color:#960050;background-color:#1e0010>：</span>捕获异常<span style=color:#960050;background-color:#1e0010>，</span>才能继续执行
</span></span><span style=display:flex><span>22:38<span style=color:#f92672>:</span>06<span style=color:#f92672>.</span><span style=color:#a6e22e>870</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo2</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>9
</span></span><span style=display:flex><span>Disconnected from the target VM<span style=color:#f92672>,</span> address<span style=color:#f92672>:</span> <span style=color:#960050;background-color:#1e0010>&#39;</span>127<span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>.</span><span style=color:#a6e22e>1</span><span style=color:#f92672>:</span>2195<span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#f92672>,</span> transport<span style=color:#f92672>:</span> <span style=color:#960050;background-color:#1e0010>&#39;</span>socket<span style=color:#960050;background-color:#1e0010>&#39;</span>
</span></span></code></pre></div><h2 id=示例三-1>示例三</h2><p>构造可以传入runable线程，优先执行。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.yanxizhu.demo.concurrency.aqs<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> lombok.extern.slf4j.Slf4j<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.BrokenBarrierException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.CyclicBarrier<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.ExecutorService<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.concurrent.Executors<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @description: CyclicBarrier 实现线程相互等待，CyclicBarrier可以传入runable线程，优先执行该部分代码
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author: &lt;a href=&#34;mailto:batis@foxmail.com&#34;&gt;清风&lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @date: 2022/4/25 22:15
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @version: 1.0
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//定义需要相互等待5个线程，就绪后才执行，后面的代码
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> CyclicBarrier cyclicBarrier <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CyclicBarrier<span style=color:#f92672>(</span>4<span style=color:#f92672>,</span> <span style=color:#f92672>()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;相互等待线程都就绪后，这部分代码先执行&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//线程池
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        ExecutorService executorService <span style=color:#f92672>=</span> Executors<span style=color:#f92672>.</span><span style=color:#a6e22e>newCachedThreadPool</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span> 10<span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> threadNum <span style=color:#f92672>=</span> i<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//模式看效果，等待1秒
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span>1000<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    pringWait<span style=color:#f92672>(</span>threadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    log<span style=color:#f92672>.</span><span style=color:#a6e22e>error</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;执行出错了。。。&#34;</span><span style=color:#f92672>,</span> e<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        executorService<span style=color:#f92672>.</span><span style=color:#a6e22e>shutdown</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>pringWait</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> threadNum<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException<span style=color:#f92672>,</span> BrokenBarrierException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//模式看效果，等待1秒
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>sleep</span><span style=color:#f92672>(</span>1000<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;等待中。。。{}&#34;</span><span style=color:#f92672>,</span> threadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//告诉线程每个就绪了，await方法支持传入超时时间
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//可选参数long timeout, TimeUnit unit
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        cyclicBarrier<span style=color:#f92672>.</span><span style=color:#a6e22e>await</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//就绪后才执行
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;开始执行了。。{}&#34;</span><span style=color:#f92672>,</span>threadNum<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>输出结果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>22:42<span style=color:#f92672>:</span>09<span style=color:#f92672>.</span><span style=color:#a6e22e>313</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>0
</span></span><span style=display:flex><span>22:42<span style=color:#f92672>:</span>10<span style=color:#f92672>.</span><span style=color:#a6e22e>313</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>2<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>1
</span></span><span style=display:flex><span>22:42<span style=color:#f92672>:</span>11<span style=color:#f92672>.</span><span style=color:#a6e22e>318</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>3<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>2
</span></span><span style=display:flex><span>22:42<span style=color:#f92672>:</span>12<span style=color:#f92672>.</span><span style=color:#a6e22e>320</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>4<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>3
</span></span><span style=display:flex><span>22:42<span style=color:#f92672>:</span>12<span style=color:#f92672>.</span><span style=color:#a6e22e>320</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>4<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> 相互等待线程都就绪后<span style=color:#960050;background-color:#1e0010>，</span>这部分代码先执行
</span></span><span style=display:flex><span>22:42<span style=color:#f92672>:</span>12<span style=color:#f92672>.</span><span style=color:#a6e22e>320</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>4<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>3
</span></span><span style=display:flex><span>22:42<span style=color:#f92672>:</span>12<span style=color:#f92672>.</span><span style=color:#a6e22e>320</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>3<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>2
</span></span><span style=display:flex><span>22:42<span style=color:#f92672>:</span>12<span style=color:#f92672>.</span><span style=color:#a6e22e>320</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>2<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>1
</span></span><span style=display:flex><span>22:42<span style=color:#f92672>:</span>12<span style=color:#f92672>.</span><span style=color:#a6e22e>320</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>0
</span></span><span style=display:flex><span>22:42<span style=color:#f92672>:</span>13<span style=color:#f92672>.</span><span style=color:#a6e22e>325</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>5<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>4
</span></span><span style=display:flex><span>22:42<span style=color:#f92672>:</span>14<span style=color:#f92672>.</span><span style=color:#a6e22e>339</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>3<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>5
</span></span><span style=display:flex><span>22:42<span style=color:#f92672>:</span>15<span style=color:#f92672>.</span><span style=color:#a6e22e>353</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>2<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>6
</span></span><span style=display:flex><span>22:42<span style=color:#f92672>:</span>16<span style=color:#f92672>.</span><span style=color:#a6e22e>355</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>7
</span></span><span style=display:flex><span>22:42<span style=color:#f92672>:</span>16<span style=color:#f92672>.</span><span style=color:#a6e22e>355</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> 相互等待线程都就绪后<span style=color:#960050;background-color:#1e0010>，</span>这部分代码先执行
</span></span><span style=display:flex><span>22:42<span style=color:#f92672>:</span>16<span style=color:#f92672>.</span><span style=color:#a6e22e>355</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>1<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>7
</span></span><span style=display:flex><span>22:42<span style=color:#f92672>:</span>16<span style=color:#f92672>.</span><span style=color:#a6e22e>355</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>5<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>4
</span></span><span style=display:flex><span>22:42<span style=color:#f92672>:</span>16<span style=color:#f92672>.</span><span style=color:#a6e22e>355</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>3<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>5
</span></span><span style=display:flex><span>22:42<span style=color:#f92672>:</span>16<span style=color:#f92672>.</span><span style=color:#a6e22e>355</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>2<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> 开始执行了<span style=color:#960050;background-color:#1e0010>。。</span>6
</span></span><span style=display:flex><span>22:42<span style=color:#f92672>:</span>17<span style=color:#f92672>.</span><span style=color:#a6e22e>358</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>4<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>8
</span></span><span style=display:flex><span>22:42<span style=color:#f92672>:</span>18<span style=color:#f92672>.</span><span style=color:#a6e22e>372</span> <span style=color:#f92672>[</span>pool<span style=color:#f92672>-</span>1<span style=color:#f92672>-</span>thread<span style=color:#f92672>-</span>2<span style=color:#f92672>]</span> INFO com<span style=color:#f92672>.</span><span style=color:#a6e22e>yanxizhu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>demo</span><span style=color:#f92672>.</span><span style=color:#a6e22e>concurrency</span><span style=color:#f92672>.</span><span style=color:#a6e22e>aqs</span><span style=color:#f92672>.</span><span style=color:#a6e22e>CyclicBarrierDemo3</span> <span style=color:#f92672>-</span> 等待中<span style=color:#960050;background-color:#1e0010>。。。</span>9
</span></span></code></pre></div><p>总结：注意CoutDownLatch与CyclicBarrier的不同，对别使用。</p></article><footer class=post-footer><ul class=post-tags><li><a href=https://willxwu.github.io/tags/java><span class=tag>Java</span></a></li><li><a href=https://willxwu.github.io/tags/thread><span class=tag>Thread</span></a></li><li><a href=https://willxwu.github.io/tags/lock><span class=tag>Lock</span></a></li><li><a href=https://willxwu.github.io/tags/synchronized><span class=tag>Synchronized</span></a></li><li><a href=https://willxwu.github.io/tags/abstractqueuedsynchronizer><span class=tag>AbstractQueuedSynchronizer</span></a></li><li><a href=https://willxwu.github.io/tags/juc><span class=tag>JUC</span></a></li></ul><p class=post-copyright>© This post is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License，please give source if you wish to quote or reproduce.This post was published <strong>515</strong> days ago, content in the post may be inaccurate, even wrong now, please take risk yourself.</p></footer><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//yanxizhu.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section><footer class=site-footer><p>© 2017-2023 Come Back</p><p>Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> with theme <a href=https://github.com/laozhu/hugo-nuo target=_blank rel=noopener>Nuo</a>.</p></footer><script src=https://cdn.jsdelivr.net/npm/smooth-scroll@15.0.0/dist/smooth-scroll.min.js></script>
<script async src=https://cdn.jsdelivr.net/npm/video.js@7.3.0/dist/video.min.js></script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type=text/x-mathjax-config>
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      displayMath: [['$$','$$'], ['\\[','\\]']],
      processEscapes: true,
      processEnvironments: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
      TeX: { equationNumbers: { autoNumber: "AMS" },
      extensions: ["AMSmath.js", "AMSsymbols.js"] }
    },
  });
</script><script type=text/x-mathjax-config>
  // Fix <code> tags after MathJax finishes running. This is a
  // hack to overcome a shortcoming of Markdown. Discussion at
  // https://github.com/mojombo/jekyll/issues/199
  MathJax.Hub.Queue(() => {
    MathJax.Hub.getAllJax().map(v => v.SourceElement().parentNode.className += ' has-jax');
  });
</script><script src=https://willxwu.github.io/scripts/index.min.js></script>
<script>"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js").then(function(){console.log("[ServiceWorker] Registered")})</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-XXXXXXXX-X","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>